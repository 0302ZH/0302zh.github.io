<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ç²¾å‡†æŠ•æ³¨è®¡ç®—å™¨ï¼ˆå¤šå¼€å¥–å·ç ç‰ˆï¼‰</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', sans-serif;
            background: #f5f5f5;
            padding: 16px;
            color: #333;
        }
        .header {
            text-align: center;
            padding: 16px;
            background: #2d8cf0;
            color: white;
            border-radius: 12px;
            margin-bottom: 16px;
        }
        .user-card {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .user-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }
        input[type="text"], input[type="number"] {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        textarea {
            width: 100%;
            height: 100px;
            padding: 12px;
            border: 1px solid #eee;
            border-radius: 8px;
            font-size: 16px;
            resize: vertical;
            background: #fafafa;
        }
        button {
            padding: 14px;
            margin: 10px 0;
            background: #2d8cf0;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }
        button.back { background: #666; }
        button.delete { background: #f53f3f; }
        .result-card {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .section-title {
            font-weight: bold;
            color: #2d8cf0;
            margin: 12px 0 8px;
            padding-bottom: 6px;
            border-bottom: 1px dashed #eee;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
            font-size: 15px;
        }
        th, td {
            padding: 8px 6px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        th { background: #f5f7fa; color: #555; }
        .win { color: #f53f3f; font-weight: bold; }
        .total {
            font-weight: bold;
            color: #2d8cf0;
            margin-top: 10px;
            padding: 10px;
            background: #f0f8ff;
            border-radius: 8px;
        }
        #results-container { margin-top: 20px; display: none; }
        .action-buttons {
            display: flex;
            gap: 12px;
            margin: 14px 0;
            flex-wrap: wrap;
        }
        .action-buttons button { flex: 1; min-width: 120px; }
        .debug-info {
            font-size: 12px;
            color: #999;
            margin-top: 5px;
            padding: 5px;
            background: #f9f9f9;
            border-radius: 4px;
        }
        .bet-type {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
            margin-left: 8px;
        }
        .hongkong { background: #ffebee; color: #e53935; }
        .macau { background: #e3f2fd; color: #1976d2; }
        .old-macau { background: #e8f5e8; color: #2e7d32; }
        .normal { background: #f3e5f5; color: #8e24aa; }
        .winning-inputs {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .winning-group { margin-bottom: 12px; }
        .winning-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: bold;
            color: #555;
        }
        .winning-input-row {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .winning-input-row input { flex: 1; }
        .winning-type {
            min-width: 80px;
            padding: 10px;
            background: #f0f8ff;
            border: 1px solid #ddd;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
        }
        .hongkong-bg { background: #ffebee; border-color: #e53935; }
        .macau-bg { background: #e3f2fd; border-color: #1976d2; }
        .old-macau-bg { background: #e8f5e8; border-color: #2e7d32; }
        .split-info {
            background: #fff8e1;
            color: #e65100;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin-top: 4px;
        }
        .history-section {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .history-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            border-left: 4px solid #2d8cf0;
        }
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        .history-time { font-size: 12px; color: #999; }
        .history-numbers {
            font-weight: bold;
            color: #2d8cf0;
            margin-bottom: 8px;
        }
        .history-actions {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
        }
        .history-actions button {
            padding: 6px 12px;
            font-size: 12px;
            margin: 0;
        }
        .name-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 12px;
        }
        .name-selector button {
            padding: 6px 12px;
            background: #f0f8ff;
            color: #2d8cf0;
            border: 1px solid #2d8cf0;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            margin: 0;
        }
        .name-selector button:hover {
            background: #2d8cf0;
            color: white;
        }
        .edit-history-btn { background: #19be6b !important; }
        .zodiac-display {
            background: #fff8e1;
            color: #e65100;
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 14px;
            margin-top: 8px;
            display: inline-block;
        }
        .money-red { color: #f53f3f; font-weight: bold; }
        .money-blue { color: #2d8cf0; font-weight: bold; }
        .user-stats-table {
            margin-top: 20px;
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .user-stats-table h3 {
            color: #2d8cf0;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
        }
        .profit-positive { color: #f53f3f; font-weight: bold; }
        .profit-negative { color: #19be6b; font-weight: bold; }
    </style>
</head>
<body>
<div class="header">
    <h2>ğŸ¯ ç²¾å‡†æŠ•æ³¨è®¡ç®—å™¨ï¼ˆå¤šå¼€å¥–å·ç ç‰ˆï¼‰</h2>
    <p>âœ… æ”¯æŒä¸­æ–‡/é˜¿æ‹‰ä¼¯æ•°å­—ï½œå¤šå¼€å¥–å·ç ï½œè‡ªåŠ¨è¯†åˆ«æŠ•æ³¨ç±»å‹</p>
</div>
<div id="users-container">
    <div class="user-card" id="user-1">
        <div class="user-header">
            <input type="text" id="name-1" placeholder="è¾“å…¥ç”¨æˆ·å" />
        </div>
        <div class="name-selector">
            <button onclick="selectName('name-1', 'é»„å®Œ')">é»„å®Œ</button>
            <button onclick="selectName('name-1', 'é»„å±•æ¨¡')">é»„å±•æ¨¡</button>
            <button onclick="selectName('name-1', 'è‡ªå·±')">è‡ªå·±</button>
            <button onclick="selectName('name-1', 'å››å¦¹')">å››å¦¹</button>
            <button onclick="selectName('name-1', 'é»„å®Œå®¶å©†')">é»„å®Œå®¶å©†</button>
            <button onclick="selectName('name-1', 'æ–¹ä¸š')">æ–¹ä¸š</button>
            <button onclick="selectName('name-1', 'é£å…°')">é£å…°</button>
            <button onclick="selectName('name-1', 'æ¢¦æ€é›¨')">æ¢¦æ€é›¨</button>
            <button onclick="selectName('name-1', 'ç‹é”¦çº¢')">ç‹é”¦çº¢</button>
            <button onclick="selectName('name-1', 'å“ä¹‰èŒ¹')">å“ä¹‰èŒ¹</button>
            <button onclick="selectName('name-1', 'æ•å§‘')">æ•å§‘</button>
            <button onclick="selectName('name-1', 'ç´å§‘')">ç´å§‘</button>
        </div>
        <textarea id="bets-1" placeholder="è¯·è¾“å…¥æŠ•æ³¨å†…å®¹ï¼Œä¾‹å¦‚ï¼š
12ã€‚24ã€‚36ã€‚48ã€‚09ã€‚45ã€‚31ã€‚07ã€‚19ã€‚09ã€‚12ã€‚24ã€‚å„11ç±³
1ä¸€å¤´å„æ•°3ç±³æ–°ï¼ˆè§£æ1ï¼‰
äºŒå°¾å„æ•°3ç±³ï¼ˆè§£æ2å°¾å·ç ï¼‰"></textarea>
    </div>
</div>
<div class="winning-inputs">
    <div class="winning-group">
        <label>ğŸ² å¼€å¥–å·ç è®¾ç½®ï¼ˆ1-49ï¼‰ï¼š</label>
        <div class="winning-input-row">
            <div class="winning-type macau-bg">æ–°æ¾³</div>
            <input type="number" id="winning-macau" min="1" max="49" placeholder="è¯·è¾“å…¥æ–°æ¾³å¼€å¥–å·ç " />
        </div>
        <div class="winning-input-row">
            <div class="winning-type old-macau-bg">æ—§æ¾³</div>
            <input type="number" id="winning-old-macau" min="1" max="49" placeholder="è¯·è¾“å…¥æ—§æ¾³å¼€å¥–å·ç " />
        </div>
        <div class="winning-input-row">
            <div class="winning-type hongkong-bg">é¦™æ¸¯</div>
            <input type="number" id="winning-hongkong" min="1" max="49" placeholder="è¯·è¾“å…¥é¦™æ¸¯å¼€å¥–å·ç " />
        </div>
    </div>
    <div style="font-size: 14px; color: #666; margin-top: 8px;">
        ğŸ’¡ æç¤ºï¼šæ”¯æŒä¸­æ–‡å¥å·ï¼ˆã€‚ï¼‰ã€ç©ºæ ¼åˆ†éš”å·ç 
    </div>
</div>
<div class="action-buttons">
    <button onclick="addUser()">â• æ·»åŠ ç”¨æˆ·</button>
    <button onclick="showResults()">ğŸ† ä¸­å¥–ç»“æœ</button>
    <button onclick="testSplit()">ğŸ§ª æµ‹è¯•æ‹†åˆ†</button>
    <button onclick="saveRecord()">ğŸ’¾ ä¿å­˜è®°å½•</button>
    <button onclick="showHistory()">ğŸ“š å†å²è®°å½•</button>
</div>
<div id="results-container">
    <div class="header">
        <h2>ğŸ† ä¸­å¥–ç»“æœ</h2>
        <p id="win-display-all">å¼€å¥–å·ç ï¼šæ–°æ¾³ ? | æ—§æ¾³ ? | é¦™æ¸¯ ?</p>
    </div>
    <p style="text-align:center; color:#999; margin-bottom:16px;" id="time-display"></p>
    <div id="results-inner"></div>
    <button onclick="hideResults()" class="back">â¬…ï¸ éšè—ç»“æœ</button>
</div>
<div id="history-container" class="history-section" style="display: none;">
    <div class="header">
        <h2>ğŸ“š å†å²è®°å½•</h2>
        <p>ä¿å­˜çš„ä¸­å¥–è®°å½•</p>
    </div>
    <div id="history-list"></div>
    <button onclick="hideHistory()" class="back">â¬…ï¸ è¿”å›</button>
</div>
<script>
// 1. åŸºç¡€æ•°æ®æ˜ å°„ï¼ˆæ–°å¢ä¸­æ–‡æ•°å­—æ˜ å°„ï¼‰
const CHINESE_NUM_MAP = {
    'é›¶':0, 'ä¸€':1, 'äºŒ':2, 'ä¸‰':3, 'å››':4, 'äº”':5,
    'å…­':6, 'ä¸ƒ':7, 'å…«':8, 'ä¹':9, 'å':10, 'ä¸¤':2, 'ä¿©':2
};
const TAIL = {
    0: [10, 20, 30, 40],
    1: [1, 11, 21, 31, 41],
    2: [2, 12, 22, 32, 42],
    3: [3, 13, 23, 33, 43],
    4: [4, 14, 24, 34, 44],
    5: [5, 15, 25, 35, 45],
    6: [6, 16, 26, 36, 46],
    7: [7, 17, 27, 37, 47],
    8: [8, 18, 28, 38, 48],
    9: [9, 19, 29, 39, 49]
};
const HEAD = {
    0: [1,2,3,4,5,6,7,8,9],        // 0å¤´ï¼ˆ01-09ï¼‰
    1: [10,11,12,13,14,15,16,17,18,19], // 1å¤´ï¼ˆ10-19ï¼‰
    2: [20,21,22,23,24,25,26,27,28,29], // 2å¤´ï¼ˆ20-29ï¼‰
    3: [30,31,32,33,34,35,36,37,38,39], // 3å¤´ï¼ˆ30-39ï¼‰
    4: [40,41,42,43,44,45,46,47,48,49], // 4å¤´ï¼ˆ40-49ï¼‰
    10:[10],11:[11],12:[12],13:[13],14:[14],15:[15],16:[16],17:[17],18:[18],19:[19],
    20:[20],21:[21],22:[22],23:[23],24:[24],25:[25],26:[26],27:[27],28:[28],29:[29]
};
const ZODIAC = {
    å…”: [3, 15, 27, 39],
    é¾™: [2, 14, 26, 38],
    è›‡: [1, 13, 25, 37, 49],
    é©¬: [12, 24, 36, 48],
    ç¾Š: [11, 23, 35, 47],
    çŒ´: [10, 22, 34, 46],
    é¸¡: [9, 21, 33, 45],
    ç‹—: [8, 20, 32, 44],
    çŒª: [7, 19, 31, 43],
    é¼ : [6, 18, 30, 42],
    ç‰›: [5, 17, 29, 41],
    è™: [4, 16, 28, 40]
};
const COLOR_WAVE = {
    çº¢æ³¢: [1,2,7,8,12,13,18,19,23,24,29,30,34,35,40,45,46],
    è“æ³¢: [3,4,9,10,14,15,20,25,26,31,36,37,41,42,47,48],
    ç»¿æ³¢: [5,6,11,16,17,21,22,27,28,32,33,38,39,43,44,49]
};
const PARITY = {
    å•: [1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31,33,35,37,39,41,43,45,47,49],
    åŒ: [2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48]
};

// 2. å…¨å±€å˜é‡
let userCount = 1;
let currentResults = null;
let editingRecordId = null;

// 3. å·¥å…·å‡½æ•°ï¼ˆæ–°å¢ä¸­æ–‡æ•°å­—è½¬æ¢ï¼Œç§»é™¤å»é‡å‡½æ•°ï¼‰
// ç§»é™¤uniqueArrå»é‡å‡½æ•°ï¼Œä¿ç•™é‡å¤å·ç 
function selectName(inputId, name) {
    document.getElementById(inputId).value = name;
}
// ä¸­æ–‡æ•°å­—è½¬é˜¿æ‹‰ä¼¯æ•°å­—ï¼ˆå•ä¸ªå­—ç¬¦ï¼‰
function charToNum(char) {
    if (!isNaN(parseInt(char))) return parseInt(char); // é˜¿æ‹‰ä¼¯æ•°å­—ç›´æ¥è¿”å›
    return CHINESE_NUM_MAP[char] !== undefined ? CHINESE_NUM_MAP[char] : null; // ä¸­æ–‡æ•°å­—è½¬æ¢
}
// ä¸­æ–‡æ•°å­—è½¬é˜¿æ‹‰ä¼¯æ•°å­—ï¼ˆå­—ç¬¦ä¸²ï¼Œå¦‚â€œåäºŒâ€â†’12ï¼‰
function chineseToNumber(chineseStr) {
    if (chineseStr in CHINESE_NUM_MAP) return CHINESE_NUM_MAP[chineseStr];
    let result = 0, temp = 0;
    for (let i=0; i<chineseStr.length; i++) {
        const num = charToNum(chineseStr[i]);
        if (num === 10) {
            temp = temp || 1;
            result += temp * 10;
            temp = 0;
        } else if (num !== null) temp = num;
    }
    return (result + temp) || 1;
}

// 4. å†å²è®°å½•åŠŸèƒ½ï¼ˆå…¨ä¿ç•™ï¼‰
function initHistory() {
    if (!localStorage.getItem('bettingHistory')) {
        localStorage.setItem('bettingHistory', JSON.stringify([]));
    }
}
function getHistory() {
    return JSON.parse(localStorage.getItem('bettingHistory') || '[]');
}
function saveHistory(history) {
    localStorage.setItem('bettingHistory', JSON.stringify(history));
}
function saveRecord() {
    if (!currentResults) {
        alert('è¯·å…ˆè®¡ç®—ä¸­å¥–ç»“æœï¼');
        return;
    }
    const history = getHistory();
    const record = {
        id: editingRecordId || Date.now(),
        timestamp: editingRecordId ? new Date().toLocaleString() + ' (å·²ç¼–è¾‘)' : new Date().toLocaleString(),
        winningNumbers: currentResults.winningNumbers,
        userData: currentResults.userData,
        totals: currentResults.totals
    };
    if (editingRecordId) {
        const idx = history.findIndex(r => r.id === editingRecordId);
        if (idx !== -1) {
            history[idx] = record;
            alert('è®°å½•æ›´æ–°æˆåŠŸï¼');
        }
    } else {
        history.unshift(record);
        alert('è®°å½•ä¿å­˜æˆåŠŸï¼');
    }
    saveHistory(history);
    editingRecordId = null;
}
function deleteRecord(id) {
    if (!confirm('ç¡®å®šåˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ')) return;
    const history = getHistory();
    saveHistory(history.filter(r => r.id !== id));
    showHistory();
}
function editRecord(id) {
    const history = getHistory();
    const record = history.find(r => r.id === id);
    if (!record) {
        alert('è®°å½•ä¸å­˜åœ¨ï¼');
        return;
    }
    editingRecordId = id;
    document.getElementById('winning-macau').value = record.winningNumbers.macau || '';
    document.getElementById('winning-old-macau').value = record.winningNumbers.oldMacau || '';
    document.getElementById('winning-hongkong').value = record.winningNumbers.hongkong || '';
    
    const container = document.getElementById('users-container');
    container.innerHTML = '';
    record.userData.forEach((user, idx) => {
        const userCard = document.createElement('div');
        userCard.className = 'user-card';
        userCard.id = `user-${idx+1}`;
        userCard.innerHTML = `
            <div class="user-header">
                <input type="text" id="name-${idx+1}" value="${user.name}" placeholder="è¾“å…¥ç”¨æˆ·å" />
            </div>
            <div class="name-selector">
                <button onclick="selectName('name-${idx+1}', 'é»„å®Œ')">é»„å®Œ</button>
                <button onclick="selectName('name-${idx+1}', 'é»„å±•æ¨¡')">é»„å±•æ¨¡</button>
                <button onclick="selectName('name-${idx+1}', 'è‡ªå·±')">è‡ªå·±</button>
                <button onclick="selectName('name-${idx+1}', 'å››å¦¹')">å››å¦¹</button>
                <button onclick="selectName('name-${idx+1}', 'é»„å®Œå®¶å©†')">é»„å®Œå®¶å©†</button>
                <button onclick="selectName('name-${idx+1}', 'æ–¹ä¸š')">æ–¹ä¸š</button>
                <button onclick="selectName('name-${idx+1}', 'é£å…°')">é£å…°</button>
                <button onclick="selectName('name-${idx+1}', 'æ¢¦æ€é›¨')">æ¢¦æ€é›¨</button>
                <button onclick="selectName('name-${idx+1}', 'ç‹é”¦çº¢')">ç‹é”¦çº¢</button>
                <button onclick="selectName('name-${idx+1}', 'å“ä¹‰èŒ¹')">å“ä¹‰èŒ¹</button>
                <button onclick="selectName('name-${idx+1}', 'æ•å§‘')">æ•å§‘</button>
                <button onclick="selectName('name-${idx+1}', 'ç´å§‘')">ç´å§‘</button>
            </div>
            <textarea id="bets-${idx+1}" placeholder="è¾“å…¥æŠ•æ³¨å†…å®¹">${user.bets}</textarea>
        `;
        container.appendChild(userCard);
    });
    userCount = record.userData.length;
    hideHistory();
    showResults();
}
function showHistory() {
    const history = getHistory();
    const container = document.getElementById('history-container');
    const list = document.getElementById('history-list');
    if (history.length === 0) {
        list.innerHTML = '<p style="text-align:center; color:#999; padding:20px;">æš‚æ— å†å²è®°å½•</p>';
    } else {
        list.innerHTML = history.map(record => `
            <div class="history-item">
                <div class="history-header">
                    <strong>è®°å½• #${record.id}</strong>
                    <span class="history-time">${record.timestamp}</span>
                </div>
                <div class="history-numbers">${getWinningDisplay(record.winningNumbers)}</div>
                <div>
                    <strong>ç”¨æˆ·æ•°é‡:</strong> ${record.userData.length} äºº<br>
                    <strong>æ€»æŠ•å…¥:</strong> <span class="money-blue">${record.totals.totalCost} å…ƒ</span><br>
                    <strong>æ€»ä¸­å¥–:</strong> <span class="money-red">${record.totals.totalWin} å…ƒ</span><br>
                    <strong>æ€»åˆ©æ¶¦:</strong> <span class="${record.totals.totalProfit >=0 ? 'money-red' : ''}">${record.totals.totalProfit >=0 ? '+' : ''}${record.totals.totalProfit}</span> å…ƒ<br>
                    <strong>ç´¯è®¡ä¸­å¥–æŠ•æ³¨:</strong> <span class="money-red">${record.totals.totalBetWin} å…ƒ</span>
                </div>
                <div class="history-actions">
                    <button onclick="loadRecord(${record.id})" style="background:#19be6b;">ğŸ“Š æŸ¥çœ‹è¯¦æƒ…</button>
                    <button onclick="editRecord(${record.id})" class="edit-history-btn">âœï¸ ç¼–è¾‘</button>
                    <button onclick="deleteRecord(${record.id})" class="delete">ğŸ—‘ï¸ åˆ é™¤</button>
                </div>
            </div>
        `).join('');
    }
    document.getElementById('results-container').style.display = 'none';
    container.style.display = 'block';
}
function loadRecord(id) {
    const history = getHistory();
    const record = history.find(r => r.id === id);
    if (!record) {
        alert('è®°å½•ä¸å­˜åœ¨ï¼');
        return;
    }
    document.getElementById('winning-macau').value = record.winningNumbers.macau || '';
    document.getElementById('winning-old-macau').value = record.winningNumbers.oldMacau || '';
    document.getElementById('winning-hongkong').value = record.winningNumbers.hongkong || '';
    
    const container = document.getElementById('users-container');
    container.innerHTML = '';
    record.userData.forEach((user, idx) => {
        const userCard = document.createElement('div');
        userCard.className = 'user-card';
        userCard.id = `user-${idx+1}`;
        userCard.innerHTML = `
            <div class="user-header">
                <input type="text" id="name-${idx+1}" value="${user.name}" placeholder="è¾“å…¥ç”¨æˆ·å" />
            </div>
            <div class="name-selector">
                <button onclick="selectName('name-${idx+1}', 'é»„å®Œ')">é»„å®Œ</button>
                <button onclick="selectName('name-${idx+1}', 'é»„å±•æ¨¡')">é»„å±•æ¨¡</button>
                <button onclick="selectName('name-${idx+1}', 'è‡ªå·±')">è‡ªå·±</button>
                <button onclick="selectName('name-${idx+1}', 'å››å¦¹')">å››å¦¹</button>
                <button onclick="selectName('name-${idx+1}', 'é»„å®Œå®¶å©†')">é»„å®Œå®¶å©†</button>
                <button onclick="selectName('name-${idx+1}', 'æ–¹ä¸š')">æ–¹ä¸š</button>
                <button onclick="selectName('name-${idx+1}', 'é£å…°')">é£å…°</button>
                <button onclick="selectName('name-${idx+1}', 'æ¢¦æ€é›¨')">æ¢¦æ€é›¨</button>
                <button onclick="selectName('name-${idx+1}', 'ç‹é”¦çº¢')">ç‹é”¦çº¢</button>
                <button onclick="selectName('name-${idx+1}', 'å“ä¹‰èŒ¹')">å“ä¹‰èŒ¹</button>
                <button onclick="selectName('name-${idx+1}', 'æ•å§‘')">æ•å§‘</button>
                <button onclick="selectName('name-${idx+1}', 'ç´å§‘')">ç´å§‘</button>
            </div>
            <textarea id="bets-${idx+1}" placeholder="è¾“å…¥æŠ•æ³¨å†…å®¹">${user.bets}</textarea>
        `;
        container.appendChild(userCard);
    });
    userCount = record.userData.length;
    hideHistory();
    showResults();
}
function hideHistory() {
    document.getElementById('history-container').style.display = 'none';
}

// 5. æ·»åŠ ç”¨æˆ·åŠŸèƒ½
function addUser() {
    userCount++;
    const container = document.getElementById('users-container');
    const newUserCard = document.createElement('div');
    newUserCard.className = 'user-card';
    newUserCard.id = `user-${userCount}`;
    newUserCard.innerHTML = `
        <div class="user-header">
            <input type="text" id="name-${userCount}" placeholder="è¾“å…¥ç”¨æˆ·å" />
        </div>
        <div class="name-selector">
            <button onclick="selectName('name-${userCount}', 'é»„å®Œ')">é»„å®Œ</button>
            <button onclick="selectName('name-${userCount}', 'é»„å±•æ¨¡')">é»„å±•æ¨¡</button>
            <button onclick="selectName('name-${userCount}', 'è‡ªå·±')">è‡ªå·±</button>
            <button onclick="selectName('name-${userCount}', 'å››å¦¹')">å››å¦¹</button>
            <button onclick="selectName('name-${userCount}', 'é»„å®Œå®¶å©†')">é»„å®Œå®¶å©†</button>
            <button onclick="selectName('name-${userCount}', 'æ–¹ä¸š')">æ–¹ä¸š</button>
            <button onclick="selectName('name-${userCount}', 'é£å…°')">é£å…°</button>
            <button onclick="selectName('name-${userCount}', 'æ¢¦æ€é›¨')">æ¢¦æ€é›¨</button>
            <button onclick="selectName('name-${userCount}', 'ç‹é”¦çº¢')">ç‹é”¦çº¢</button>
            <button onclick="selectName('name-${userCount}', 'å“ä¹‰èŒ¹')">å“ä¹‰èŒ¹</button>
            <button onclick="selectName('name-${userCount}', 'æ•å§‘')">æ•å§‘</button>
            <button onclick="selectName('name-${userCount}', 'ç´å§‘')">ç´å§‘</button>
        </div>
        <textarea id="bets-${userCount}" placeholder="è¾“å…¥æŠ•æ³¨å†…å®¹"></textarea>
    `;
    container.appendChild(newUserCard);
}

// 6. ç”Ÿè‚–æ˜¾ç¤ºå·¥å…·
function getZodiacLabel(num) {
    for (const [zodiac, nums] of Object.entries(ZODIAC)) {
        if (nums.includes(num)) return `${zodiac}${num}`;
    }
    return num.toString();
}
function getZodiacDisplay(num) {
    for (const [zodiac, nums] of Object.entries(ZODIAC)) {
        if (nums.includes(num)) return `${num}ï¼ˆ${zodiac}ï¼‰`;
    }
    return num.toString();
}
function getTodayZodiacDisplay(winningNumbers) {
    const parts = [];
    if (winningNumbers.macau) parts.push(`æ–°æ¾³${getZodiacDisplay(winningNumbers.macau)}`);
    if (winningNumbers.oldMacau) parts.push(`æ—§æ¾³${getZodiacDisplay(winningNumbers.oldMacau)}`);
    if (winningNumbers.hongkong) parts.push(`é¦™æ¸¯${getZodiacDisplay(winningNumbers.hongkong)}`);
    return parts.join(' ') || 'æ— å¼€å¥–å·ç ';
}

// 7. æ ¸å¿ƒä¿®å¤ï¼šæå–æ•°å­—ï¼ˆæ”¯æŒä¸­æ–‡+é˜¿æ‹‰ä¼¯æ··åˆï¼Œä¿ç•™é‡å¤ï¼‰
function getDigits(text) {
    const digits = [];
    // éå†æ¯ä¸ªå­—ç¬¦ï¼Œæå–æœ‰æ•ˆæ•°å­—ï¼ˆä¸­æ–‡+é˜¿æ‹‰ä¼¯ï¼‰ï¼Œä¿ç•™é‡å¤
    for (let i=0; i<text.length; i++) {
        const char = text[i];
        const num = charToNum(char);
        if (num !== null && num >=0 && num <=9) { // åªä¿ç•™0-9çš„æœ‰æ•ˆæ•°å­—
            digits.push(num);
        }
    }
    // åœºæ™¯1ï¼šé€—å·/ä¸­æ–‡å¥å·åˆ†éš”ï¼ˆä¿ç•™é‡å¤ï¼Œä¸å»é‡ï¼‰
    if (text.includes(',') || text.includes('ã€‚')) {
        // æ›¿æ¢ä¸­æ–‡å¥å·ä¸ºé€—å·ï¼Œç»Ÿä¸€æ‹†åˆ†
        const splitText = text.replace(/ã€‚/g, ',').split(',');
        splitText.forEach(part => {
            const cleanPart = part.trim();
            const partNum = isNaN(parseInt(cleanPart)) ? chineseToNumber(cleanPart) : parseInt(cleanPart);
            if (partNum >=0 && partNum <=9) {
                digits.push(partNum); // ç›´æ¥æ·»åŠ ï¼Œä¿ç•™é‡å¤
            }
        });
    }
    return digits; // ä¸åšå»é‡
}

// 8. æŠ•æ³¨è§£æï¼ˆæ”¯æŒä¸­æ–‡æ•°å­—+ä¸­æ–‡å¥å·åˆ†éš”ï¼Œä¿ç•™é‡å¤å·ç ï¼‰
function splitBetsByAmount(text) {
    const lines = [];
    const rawLines = text.split('\n').filter(line => line.trim());
    for (const rawLine of rawLines) {
        const cleanLine = rawLine.trim();
        if (!cleanLine) continue;
        
        const segments = [];
        const amountPattern = /(?:å„(?:æ•°)?|åŒ…)\s*(?:[\dä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åä¸¤ä¿©ç™¾]+\s*(?:ç±³|å…ƒ)?|[\dä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åä¸¤ä¿©ç™¾]+\s*å°¾\s*[\dä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åä¸¤ä¿©ç™¾]+\s*(?:ç±³|å…ƒ)?)/g;
        const amountMatches = [...cleanLine.matchAll(amountPattern)];
        
        if (amountMatches.length === 0) {
            segments.push(cleanLine);
        } else {
            let lastIndex = 0;
            amountMatches.forEach((match, idx) => {
                const matchIdx = match.index;
                const matchText = match[0];
                if (matchIdx > lastIndex) {
                    const segment = cleanLine.substring(lastIndex, matchIdx + matchText.length).trim();
                    if (segment) segments.push(segment);
                } else if (matchIdx === 0) {
                    const segment = cleanLine.substring(0, matchText.length).trim();
                    if (segment) segments.push(segment);
                }
                lastIndex = matchIdx + matchText.length;
                if (idx === amountMatches.length - 1 && lastIndex < cleanLine.length) {
                    const remaining = cleanLine.substring(lastIndex).trim();
                    if (remaining) {
                        segments[segments.length - 1] += ' ' + remaining;
                    }
                }
            });
        }
        segments.forEach(seg => seg.trim() && lines.push(seg.trim()));
    }
    return lines;
}
function getBetType(line) {
    const clean = line.trim();
    if (/é¦™æ¸¯|é¦™(?![æ¸¯æ¾³]|å£|æ°´)/.test(clean)) return 'hongkong';
    if (/æ¾³é—¨|æ–°æ¾³|æ–°/.test(clean)) return 'macau';
    if (/æ—§/.test(clean)) return 'old-macau';
    return 'normal';
}
function getBetTypeLabel(betType) {
    switch(betType) {
        case 'hongkong': return '<span class="bet-type hongkong">é¦™æ¸¯</span>';
        case 'macau': return '<span class="bet-type macau">æ–°æ¾³</span>';
        case 'old-macau': return '<span class="bet-type old-macau">æ—§æ¾³</span>';
        default: return '<span class="bet-type normal">æ™®é€š</span>';
    }
}
// å°¾æ•°è§£æï¼ˆä¿ç•™é‡å¤ï¼Œä¸å»é‡ï¼‰
function parseTailNumbers(text) {
    const nums = [];
    const digits = getDigits(text);
    digits.forEach(d => {
        if (d >=0 && d <=9 && TAIL[d]) {
            nums.push(...TAIL[d]); // ç›´æ¥æ·»åŠ å°¾æ•°å¯¹åº”å·ç ï¼Œä¿ç•™é‡å¤
        }
    });
    return nums; // ä¸åšå»é‡
}
// å¤´æ•°è§£æï¼ˆä¿ç•™é‡å¤ï¼Œä¸å»é‡ï¼‰
function parseHeadNumbers(text) {
    const nums = [];
    const digits = getDigits(text);
    digits.forEach(d => {
        if (d >=0 && d <=4 && HEAD[d]) {
            nums.push(...HEAD[d]); // ç›´æ¥æ·»åŠ å¤´æ•°å¯¹åº”å·ç ï¼Œä¿ç•™é‡å¤
        }
        if (d >=10 && d <=49 && HEAD[d]) {
            nums.push(...HEAD[d]); // ç›´æ¥æ·»åŠ ï¼Œä¿ç•™é‡å¤
        }
    });
    return nums; // ä¸åšå»é‡
}
// æå–é‡‘é¢ï¼ˆæ”¯æŒâ€œå„11ç±³â€ç­‰æ ¼å¼ï¼‰
function extractAmount(line) {
    // åŒ¹é…ä¸­æ–‡é‡‘é¢ï¼ˆå¦‚â€œåŒ…äº”ç±³â€â€œå„ä¸¤ç±³â€ï¼‰
    let match = line.match(/(åŒ…|å„(?:æ•°)?)+\s*([ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åä¸¤ä¿©ç™¾]+)\s*(?:ç±³|å…ƒ)?/i);
    if (match) {
        const check = line.substring(match.index + match[0].length);
        if (!check.includes('å°¾') && !check.includes('å¤´')) return chineseToNumber(match[2]);
    }
    // åŒ¹é…é˜¿æ‹‰ä¼¯é‡‘é¢ï¼ˆå¦‚â€œåŒ…5ç±³â€â€œå„11ç±³â€ï¼‰
    match = line.match(/(åŒ…|å„(?:æ•°)?)+\s*(\d+)\s*(?:ç±³|å…ƒ)?(?=\s|$|æ–°|æ—§|é¦™æ¸¯|æ¾³é—¨|å¤´|å°¾)/i);
    if (match) {
        const check = line.substring(match.index + match[0].length);
        if (!check.includes('å°¾') && !check.includes('å¤´')) return parseInt(match[2]);
    }
    // åŒ¹é…â€œå„Xç±³â€â€œXç±³â€
    match = line.match(/å„(?:æ•°)?\s*(\d+)\s*(?:ç±³|å…ƒ)/i) || line.match(/(\d+)\s*(?:ç±³|å…ƒ)(?!\d)/);
    if (match) return parseInt(match[1]);
    return 1;
}
function getTextExcludingAmount(text) {
    let result = text;
    // ç§»é™¤ä¸­æ–‡é‡‘é¢
    result = result.replace(/åŒ…\s*[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åä¸¤ä¿©]+\s*(?:ç±³|å…ƒ)?(?=\s|$|æ–°|æ—§|é¦™æ¸¯|æ¾³é—¨)/gi, '');
    // ç§»é™¤é˜¿æ‹‰ä¼¯é‡‘é¢
    result = result.replace(/(åŒ…|å„(?:æ•°)?)+\s*\d+\s*(?:ç±³|å…ƒ)?(?=\s|$|æ–°|æ—§|é¦™æ¸¯|æ¾³é—¨)/gi, '');
    result = result.replace(/å„(?:æ•°)?\s*[\dä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åä¸¤ä¿©]+\s*(?:ç±³|å…ƒ)?/gi, '');
    result = result.replace(/(\d+)\s*(?:ç±³|å…ƒ)(?!\d)/g, '');
    return result.trim();
}
// æ€»å·ç è§£æï¼ˆæ ¸å¿ƒä¿®å¤ï¼šæ”¯æŒä¸­æ–‡å¥å·åˆ†éš”ï¼Œä¿ç•™é‡å¤å·ç ï¼‰
function parseNumbers(text) {
    const cleanedText = getTextExcludingAmount(text);
    let nums = [];
    // å°¾æ•°æŠ•æ³¨ï¼ˆä¿ç•™é‡å¤ï¼‰
    if (cleanedText.includes('å°¾')) {
        nums = parseTailNumbers(cleanedText);
    }
    // å¤´æ•°æŠ•æ³¨ï¼ˆä¿ç•™é‡å¤ï¼‰
    else if (cleanedText.includes('å¤´')) {
        nums = parseHeadNumbers(cleanedText);
    }
    // æ™®é€šæŠ•æ³¨ï¼ˆæ”¯æŒä¸­æ–‡å¥å·åˆ†éš”ï¼Œä¿ç•™é‡å¤å·ç ï¼‰
    else {
        // æ›¿æ¢ä¸­æ–‡å¥å·ä¸ºç©ºæ ¼ï¼Œç¡®ä¿èƒ½åŒ¹é…æ‰€æœ‰å·ç 
        const formatText = cleanedText.replace(/ã€‚/g, ' ');
        // åŒ¹é…æ‰€æœ‰æ•°å­—ï¼ˆåŒ…æ‹¬09è¿™ç±»å¸¦å‰å¯¼0çš„ï¼Œåç»­è½¬ä¸ºçº¯æ•°å­—ï¼‰
        const numMatches = formatText.match(/\b\d{1,2}\b/g);
        if (numMatches) {
            numMatches.forEach(match => {
                const n = parseInt(match); // 09â†’9ï¼Œ12â†’12ï¼Œä¿ç•™åŸå§‹é‡å¤é¡ºåº
                if (n >=1 && n <=49) {
                    nums.push(n); // ç›´æ¥æ·»åŠ ï¼Œä¸åšå»é‡ï¼Œä¿ç•™é‡å¤
                }
            });
        }
        // ç”Ÿè‚–è§£æï¼ˆä¿ç•™é‡å¤ï¼‰
        for (const [zodiac, zodiacNums] of Object.entries(ZODIAC)) {
            if (cleanedText.includes(zodiac)) {
                nums.push(...zodiacNums); // ç›´æ¥æ·»åŠ ï¼Œä¿ç•™é‡å¤
            }
        }
        // é¢œè‰²æ³¢è§£æï¼ˆä¿ç•™é‡å¤ï¼‰
        const colorKeys = { 'çº¢':'çº¢æ³¢', 'è“':'è“æ³¢', 'ç»¿':'ç»¿æ³¢', 'çº¢æ³¢':'çº¢æ³¢', 'è“æ³¢':'è“æ³¢', 'ç»¿æ³¢':'ç»¿æ³¢' };
        for (const [key, color] of Object.entries(colorKeys)) {
            if (cleanedText.includes(key)) {
                nums.push(...COLOR_WAVE[color]); // ç›´æ¥æ·»åŠ ï¼Œä¿ç•™é‡å¤
            }
        }
        // å•åŒè§£æï¼ˆä¿ç•™é‡å¤ï¼‰
        for (const [pType, pNums] of Object.entries(PARITY)) {
            if (cleanedText.includes(pType)) {
                nums.push(...pNums); // ç›´æ¥æ·»åŠ ï¼Œä¿ç•™é‡å¤
            }
        }
    }
    return nums; // æœ€ç»ˆè¿”å›å¸¦é‡å¤çš„å·ç æ•°ç»„
}

// 9. å¼€å¥–å·ç ä¸ä¸­å¥–è®¡ç®—
function getWinningNumbers() {
    const winning = {};
    const macau = parseInt(document.getElementById('winning-macau').value.trim());
    const oldMacau = parseInt(document.getElementById('winning-old-macau').value.trim());
    const hongkong = parseInt(document.getElementById('winning-hongkong').value.trim());
    if (!isNaN(macau) && macau >=1 && macau <=49) winning.macau = macau;
    if (!isNaN(oldMacau) && oldMacau >=1 && oldMacau <=49) winning.oldMacau = oldMacau;
    if (!isNaN(hongkong) && hongkong >=1 && hongkong <=49) winning.hongkong = hongkong;
    return winning;
}
function getWinningNumByBetType(betType, winning) {
    switch(betType) {
        case 'macau': return winning.macau;
        case 'old-macau': return winning.oldMacau;
        case 'hongkong': return winning.hongkong;
        case 'normal': return winning.macau;
        default: return null;
    }
}
// ä¸­å¥–é‡‘é¢è®¡ç®—ï¼ˆé‡å¤å·ç ä¸­å¥–æ—¶ï¼Œæ¯é‡å¤ä¸€æ¬¡éƒ½è®¡ç®—ä¸­å¥–ï¼‰
function getWinAmount(betType, perBet, nums, winning) {
    const winNum = getWinningNumByBetType(betType, winning);
    if (!winNum) return 0;
    // ç»Ÿè®¡é‡å¤å·ç ä¸­åŒ…å«å¼€å¥–å·çš„æ¬¡æ•°ï¼Œæ¯æ¬¡éƒ½ç®—ä¸­å¥–ï¼ˆ47å€ï¼‰
    const winCount = nums.filter(num => num === winNum).length;
    return winCount * perBet * 47;
}
function getWinningDisplay(winning) {
    const parts = [];
    if (winning.macau) parts.push(`æ–°æ¾³ ${getZodiacLabel(winning.macau)}`);
    if (winning.oldMacau) parts.push(`æ—§æ¾³ ${getZodiacLabel(winning.oldMacau)}`);
    if (winning.hongkong) parts.push(`é¦™æ¸¯ ${getZodiacLabel(winning.hongkong)}`);
    return parts.join(' | ') || 'æ— æœ‰æ•ˆå¼€å¥–å·ç ';
}
function processNewOldBets(lines) {
    const processed = [];
    lines.forEach(line => {
        const trimLine = line.trim();
        if (!trimLine) return;
        if (trimLine.includes('æ–°') && trimLine.includes('æ—§')) {
            processed.push({
                line: trimLine.replace(/æ—§/g, '').trim(),
                betType: 'macau',
                originalLine: trimLine,
                isSplit: true,
                splitType: 'æ–°æ¾³'
            });
            processed.push({
                line: trimLine.replace(/æ–°/g, '').trim(),
                betType: 'old-macau',
                originalLine: trimLine,
                isSplit: true,
                splitType: 'æ—§æ¾³'
            });
        } else {
            processed.push({
                line: trimLine,
                betType: null,
                originalLine: trimLine,
                isSplit: false
            });
        }
    });
    return processed;
}

// 10. æ˜¾ç¤ºä¸­å¥–ç»“æœ
function showResults() {
    try {
        const winning = getWinningNumbers();
        if (!winning.macau) {
            alert('è¯·è¾“å…¥1-49çš„æ–°æ¾³å¼€å¥–å·ç ï¼ˆæ™®é€šæŠ•æ³¨éœ€æ­¤å·ç è®¡ç®—ï¼‰');
            return;
        }
        
        // æ”¶é›†ç”¨æˆ·æ•°æ®
        const userData = [];
        document.querySelectorAll('#users-container .user-card').forEach(card => {
            const id = card.id.replace('user-', '');
            const name = document.getElementById(`name-${id}`).value.trim() || `ç”¨æˆ·${id}`;
            const bets = document.getElementById(`bets-${id}`).value.trim();
            if (bets) userData.push({ name, bets });
        });
        if (userData.length === 0) {
            alert('è¯·è‡³å°‘è¾“å…¥ä¸€ä¸ªç”¨æˆ·çš„æŠ•æ³¨å†…å®¹');
            return;
        }
        
        // æ˜¾ç¤ºç»“æœå®¹å™¨
        document.getElementById('results-container').style.display = 'block';
        document.getElementById('win-display-all').textContent = 'å¼€å¥–å·ç ï¼š' + getWinningDisplay(winning);
        document.getElementById('time-display').textContent = 'ç”Ÿæˆæ—¶é—´ï¼š' + new Date().toLocaleString();
        const resultInner = document.getElementById('results-inner');
        resultInner.innerHTML = '';
        
        // ç»Ÿè®¡æ•°æ®
        const userStats = [];
        let totalCost = 0, totalWin = 0, totalWinBet = 0;
        
        // å¤„ç†æ¯ä¸ªç”¨æˆ·
        userData.forEach(user => {
            const rawLines = user.bets.split('\n').filter(l => l.trim());
            const lines = [];
            rawLines.forEach(raw => lines.push(...splitBetsByAmount(raw)));
            const processedLines = processNewOldBets(lines);
            
            let userCost = 0, userWin = 0, userWinBet = 0;
            let betHtml = '';
            
            processedLines.forEach(item => {
                const line = item.line;
                const betType = item.betType || getBetType(line);
                const perBet = extractAmount(line);
                const nums = parseNumbers(line);
                if (nums.length === 0) return;
                
                // æ€»æŠ•å…¥=å·ç ä¸ªæ•°ï¼ˆå«é‡å¤ï¼‰Ã—å•æ³¨é‡‘é¢
                const cost = nums.length * perBet;
                const winMoney = getWinAmount(betType, perBet, nums, winning);
                const isWin = winMoney > 0;
                // ä¸­å¥–æŠ•æ³¨é‡‘é¢=ä¸­å¥–æ¬¡æ•°Ã—å•æ³¨é‡‘é¢ï¼ˆé‡å¤ä¸­å¥–å¤šæ¬¡åˆ™ç´¯åŠ ï¼‰
                const winBet = isWin ? (nums.filter(num => num === getWinningNumByBetType(betType, winning)).length * perBet) : 0;
                
                // ç´¯åŠ ç»Ÿè®¡
                userCost += cost;
                userWin += winMoney;
                userWinBet += winBet;
                
                // æ¸²æŸ“å•æ¡æŠ•æ³¨ï¼ˆç§»é™¤â€œå«é‡å¤â€æç¤ºï¼‰
                const lineDisplay = item.isSplit ? `<span title="åŸæŠ•æ³¨: ${item.originalLine}">${line}</span>` : line;
                const winNum = getWinningNumByBetType(betType, winning);
                const headTailDesc = line.includes('å¤´') ? `ï¼ˆå¤´æ•°: ${getDigits(line).join(', ')}ï¼‰` : 
                                     line.includes('å°¾') ? `ï¼ˆå°¾æ•°: ${getDigits(line).join(', ')}ï¼‰` : '';
                // æ ‡è®°ä¸­å¥–å·ç ï¼ˆé‡å¤çš„ä¹Ÿæ ‡è®°ï¼‰
                const markedNums = nums.map(num => num === winNum ? `<span class="money-red">${num}</span>` : num).join(', ');
                betHtml += `
                    <tr>
                        <td>${lineDisplay} ${getBetTypeLabel(betType)}</td>
                        <td>${nums.length}</td>
                        <td><span class="money-blue">${cost} å…ƒ</span></td>
                        <td class="${isWin ? 'win' : ''}"><span class="money-red">${isWin ? winMoney + ' å…ƒ' : '-'}</span></td>
                    </tr>
                `;
                if (item.isSplit) {
                    betHtml += `
                        <tr>
                            <td colspan="4" class="split-info">ğŸ“ è‡ªåŠ¨æ‹†åˆ†è‡ª: "${item.originalLine}" â†’ ${item.splitType}</td>
                        </tr>
                    `;
                }
                betHtml += `
                    <tr>
                        <td colspan="4" class="debug-info">è§£æå·ç : ${markedNums} ${headTailDesc}| å•æ³¨: ${perBet}ç±³ | å¼€å¥–å·: ${winNum || 'æ— '}</td>
                    </tr>
                `;
            });
            
            // ç´¯åŠ å…¨å±€ç»Ÿè®¡
            totalCost += userCost;
            totalWin += userWin;
            totalWinBet += userWinBet;
            userStats.push({
                name: user.name,
                cost: userCost,
                win: userWin,
                profit: userWin - userCost,
                winBet: userWinBet
            });
            
            // æ¸²æŸ“ç”¨æˆ·ç»“æœï¼ˆç§»é™¤â€œä¿ç•™é‡å¤å·ç â€æç¤ºï¼‰
            const userHtml = `
                <div class="result-card">
                    <h3>ğŸ‘¤ ${user.name}</h3>
                    <div class="section-title">æŠ•æ³¨è¯¦æƒ…ï¼ˆ47å€ï¼‰</div>
                    <table>
                        <tr>
                            <th>å†…å®¹</th>
                            <th>å·ç æ•°é‡</th>
                            <th>æŠ•å…¥</th>
                            <th>ä¸­å¥–</th>
                        </tr>
                        ${betHtml}
                    </table>
                    <div class="total">
                        ğŸ’° æŠ•å…¥ï¼š<span class="money-blue">${userCost} å…ƒ</span> | ä¸­å¥–ï¼š<span class="money-red">${userWin} å…ƒ</span> | å‡€åˆ©æ¶¦ï¼š<span class="${(userWin - userCost)>=0 ? 'profit-positive' : 'profit-negative'}">${(userWin - userCost)>=0 ? '+' : ''}${userWin - userCost}</span> å…ƒ<br>
                        <span class="total-bet-win">ç´¯è®¡ä¸­å¥–æŠ•æ³¨ï¼š<span class="money-red">${userWinBet} å…ƒ</span></span><br>
                        <span class="zodiac-display">ä»Šæ—¥ç”Ÿè‚–ï¼š${getTodayZodiacDisplay(winning)}</span>
                    </div>
                </div>
            `;
            resultInner.innerHTML += userHtml;
        });
        
        // æ¸²æŸ“å…¨å±€æ±‡æ€»
        const totalProfit = totalWin - totalCost;
        resultInner.innerHTML += `
            <div class="total" style="margin-top:20px;">
                ğŸ“Š å…¨ä½“æ±‡æ€»ï¼š<br>
                æ€»æŠ•å…¥ï¼š<span class="money-blue">${totalCost} å…ƒ</span><br>
                æ€»ä¸­å¥–ï¼š<span class="money-red">${totalWin} å…ƒ</span><br>
                æ€»å‡€åˆ©æ¶¦ï¼š<span class="${totalProfit>=0 ? 'profit-positive' : 'profit-negative'}">${totalProfit>=0 ? '+' : ''}${totalProfit}</span> å…ƒ<br>
                <span class="total-bet-win">ç´¯è®¡ä¸­å¥–æŠ•æ³¨ï¼š<span class="money-red">${totalWinBet} å…ƒ</span></span><br>
                <span class="zodiac-display">ä»Šæ—¥ç”Ÿè‚–ï¼š${getTodayZodiacDisplay(winning)}</span>
            </div>
        `;
        
        // æ¸²æŸ“ç”¨æˆ·ç»Ÿè®¡è¡¨æ ¼
        let statsHtml = `
            <div class="user-stats-table">
                <h3>ğŸ‘¥ ç”¨æˆ·è¯¦ç»†ç»Ÿè®¡</h3>
                <table>
                    <tr>
                        <th>ç”¨æˆ·å</th>
                        <th>æŠ•å…¥</th>
                        <th>ä¸­å¥–</th>
                        <th>å‡€åˆ©æ¶¦</th>
                        <th>ç´¯è®¡ä¸­å¥–æŠ•æ³¨</th>
                    </tr>
        `;
        userStats.forEach(stat => {
            statsHtml += `
                <tr>
                    <td><strong>${stat.name}</strong></td>
                    <td><span class="money-blue">${stat.cost} å…ƒ</span></td>
                    <td><span class="money-red">${stat.win} å…ƒ</span></td>
                    <td class="${stat.profit>=0 ? 'profit-positive' : 'profit-negative'}">${stat.profit>=0 ? '+' : ''}${stat.profit} å…ƒ</td>
                    <td><span class="money-red">${stat.winBet} å…ƒ</span></td>
                </tr>
            `;
        });
        statsHtml += `</table></div>`;
        resultInner.innerHTML += statsHtml;
        
        // ä¿å­˜å½“å‰ç»“æœ
        currentResults = {
            winningNumbers: winning,
            userData: userData,
            totals: {
                totalCost: totalCost,
                totalWin: totalWin,
                totalProfit: totalProfit,
                totalWinBet: totalWinBet
            }
        };
    } catch (error) {
        alert('è®¡ç®—å‡ºé”™ï¼š' + error.message);
        console.error('é”™è¯¯è¯¦æƒ…ï¼š', error);
    }
}

// 11. å…¶ä»–è¾…åŠ©å‡½æ•°ï¼ˆç§»é™¤æµ‹è¯•æ‹†åˆ†ä¸­çš„â€œå«é‡å¤â€æç¤ºï¼‰
function hideResults() {
    document.getElementById('results-container').style.display = 'none';
}
function testSplit() {
    const betText = document.getElementById('bets-1').value.trim();
    if (!betText) {
        alert('è¯·å…ˆåœ¨ç”¨æˆ·1çš„æŠ•æ³¨æ¡†è¾“å…¥å†…å®¹ï¼ˆå¦‚ï¼š12ã€‚24ã€‚36ã€‚48ã€‚09ã€‚45ã€‚31ã€‚07ã€‚19ã€‚09ã€‚12ã€‚24ã€‚å„11ç±³ï¼‰');
        return;
    }
    const lines = splitBetsByAmount(betText);
    const processed = processNewOldBets(lines);
    let result = `æ‹†åˆ†ç»“æœï¼ˆå…±${processed.length}æ¡ï¼‰ï¼š\n\n`;
    processed.forEach((item, idx) => {
        const nums = parseNumbers(item.line);
        const amount = extractAmount(item.line);
        const betType = item.betType || getBetType(item.line);
        const headTailDesc = item.line.includes('å¤´') ? `å¤´æ•°: ${getDigits(item.line).join(', ')}` : 
                             item.line.includes('å°¾') ? `å°¾æ•°: ${getDigits(item.line).join(', ')}` : '';
        result += `${idx+1}. å†…å®¹ï¼š${item.line}\n`;
        result += `   ç±»å‹ï¼š${betType === 'macau' ? 'æ–°æ¾³' : betType === 'old-macau' ? 'æ—§æ¾³' : betType === 'hongkong' ? 'é¦™æ¸¯' : 'æ™®é€š'}\n`;
        result += `   ${headTailDesc}\n`;
        result += `   é‡‘é¢ï¼š${amount} ç±³\n`;
        result += `   å·ç ï¼š${nums.join(', ')}\n`; // ç§»é™¤â€œï¼ˆå«é‡å¤ï¼‰â€
        result += `   å·ç ä¸ªæ•°ï¼š${nums.length} ä¸ª\n\n`;
    });
    alert(result);
}

// 12. åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
    initHistory();
});
</script>
</body>
</html>
