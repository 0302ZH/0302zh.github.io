<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ç²¾å‡†æŠ•æ³¨è®¡ç®—å™¨ï¼ˆå¤šå¼€å¥–å·ç ç‰ˆï¼‰</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', sans-serif;
            background: #f5f5f5;
            padding: 16px;
            color: #333;
        }
        .header {
            text-align: center;
            padding: 16px;
            background: #2d8cf0;
            color: white;
            border-radius: 12px;
            margin-bottom: 16px;
        }
        .user-card {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .user-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }
        input[type="text"], input[type="number"] {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        textarea {
            width: 100%;
            height: 100px;
            padding: 12px;
            border: 1px solid #eee;
            border-radius: 8px;
            font-size: 16px;
            resize: vertical;
            background: #fafafa;
        }
        button {
            padding: 14px;
            margin: 10px 0;
            background: #2d8cf0;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }
        button.back {
            background: #666;
        }
        button.delete {
            background: #f53f3f;
        }
        .result-card {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .section-title {
            font-weight: bold;
            color: #2d8cf0;
            margin: 12px 0 8px;
            padding-bottom: 6px;
            border-bottom: 1px dashed #eee;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
            font-size: 15px;
        }
        th, td {
            padding: 8px 6px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        th { background: #f5f7fa; color: #555; }
        .win { color: #f53f3f; font-weight: bold; }
        .total {
            font-weight: bold;
            color: #2d8cf0;
            margin-top: 10px;
            padding: 10px;
            background: #f0f8ff;
            border-radius: 8px;
        }
        #results-container {
            margin-top: 20px;
            display: none;
        }

        .action-buttons {
            display: flex;
            gap: 12px;
            margin: 14px 0;
            flex-wrap: wrap;
        }
        .action-buttons button {
            flex: 1;
            min-width: 120px;
        }
        
        .debug-info {
            font-size: 12px;
            color: #999;
            margin-top: 5px;
            padding: 5px;
            background: #f9f9f9;
            border-radius: 4px;
        }
        
        .bet-type {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
            margin-left: 8px;
        }
        .hongkong { background: #ffebee; color: #e53935; }
        .macau { background: #e3f2fd; color: #1976d2; }
        .old-macau { background: #e8f5e8; color: #2e7d32; }
        .normal { background: #f3e5f5; color: #8e24aa; }
        
        .winning-inputs {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .winning-group {
            margin-bottom: 12px;
        }
        .winning-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: bold;
            color: #555;
        }
        .winning-input-row {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .winning-input-row input {
            flex: 1;
        }
        .winning-type {
            min-width: 80px;
            padding: 10px;
            background: #f0f8ff;
            border: 1px solid #ddd;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
        }
        .hongkong-bg { background: #ffebee; border-color: #e53935; }
        .macau-bg { background: #e3f2fd; border-color: #1976d2; }
        .old-macau-bg { background: #e8f5e8; border-color: #2e7d32; }
        
        .split-info {
            background: #fff8e1;
            color: #e65100;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin-top: 4px;
        }
        
        .history-section {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .history-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            border-left: 4px solid #2d8cf0;
        }
        
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .history-time {
            font-size: 12px;
            color: #999;
        }
        
        .history-numbers {
            font-weight: bold;
            color: #2d8cf0;
            margin-bottom: 8px;
        }
        
        .history-actions {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
        }
        
        .history-actions button {
            padding: 6px 12px;
            font-size: 12px;
            margin: 0;
        }
        
        /* æ–°å¢æ ·å¼ï¼šç”¨æˆ·åé€‰æ‹©å™¨ */
        .name-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 12px;
        }
        .name-selector button {
            padding: 6px 12px;
            background: #f0f8ff;
            color: #2d8cf0;
            border: 1px solid #2d8cf0;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            margin: 0;
        }
        .name-selector button:hover {
            background: #2d8cf0;
            color: white;
        }
        
        /* ç¼–è¾‘å†å²è®°å½•æ ·å¼ */
        .edit-history-btn {
            background: #19be6b !important;
        }
        
        /* æ–°å¢æ ·å¼ï¼šç”Ÿè‚–æ˜¾ç¤º */
        .zodiac-display {
            background: #fff8e1;
            color: #e65100;
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 14px;
            margin-top: 8px;
            display: inline-block;
        }
        
        /* æ–°å¢æ ·å¼ï¼šç´¯è®¡ä¸­å¥–æŠ•æ³¨ */
        .total-bet-win {
            color: #19be6b;
            font-weight: bold;
        }
        
        /* æ–°å¢æ ·å¼ï¼šé‡‘é¢çº¢è‰²æ˜¾ç¤º */
        .money-red {
            color: #f53f3f;
            font-weight: bold;
        }
        
        /* æ–°å¢æ ·å¼ï¼šé‡‘é¢è“è‰²æ˜¾ç¤º */
        .money-blue {
            color: #2d8cf0;
            font-weight: bold;
        }
        
        /* æ–°å¢æ ·å¼ï¼šç”¨æˆ·ç»Ÿè®¡è¡¨æ ¼ */
        .user-stats-table {
            margin-top: 20px;
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .user-stats-table h3 {
            color: #2d8cf0;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
        }
        
        .profit-positive {
            color: #f53f3f;
            font-weight: bold;
        }
        
        .profit-negative {
            color: #19be6b;
            font-weight: bold;
        }
    </style>
</head>
<body>

<div class="header">
    <h2>ğŸ¯ ç²¾å‡†æŠ•æ³¨è®¡ç®—å™¨ï¼ˆå¤šå¼€å¥–å·ç ç‰ˆï¼‰</h2>
    <p>âœ… æ”¯æŒå¤šå¼€å¥–å·ç ï½œè‡ªåŠ¨è¯†åˆ«æŠ•æ³¨ç±»å‹ï½œæ™®é€šæŠ•æ³¨é»˜è®¤æŒ‰æ–°æ¾³è®¡ç®—</p>
</div>

<div id="users-container">
    <div class="user-card" id="user-1">
        <div class="user-header">
            <input type="text" id="name-1" placeholder="è¾“å…¥ç”¨æˆ·å" />
        </div>
        <div class="name-selector">
            <button onclick="selectName('name-1', 'é»„å®Œ')">é»„å®Œ</button>
            <button onclick="selectName('name-1', 'é»„å±•æ¨¡')">é»„å±•æ¨¡</button>
            <button onclick="selectName('name-1', 'è‡ªå·±')">è‡ªå·±</button>
            <button onclick="selectName('name-1', 'å››å¦¹')">å››å¦¹</button>
            <button onclick="selectName('name-1', 'é»„å®Œå®¶å©†')">é»„å®Œå®¶å©†</button>
            <button onclick="selectName('name-1', 'æ–¹ä¸š')">æ–¹ä¸š</button>
            <button onclick="selectName('name-1', 'é£å…°')">é£å…°</button>
            <button onclick="selectName('name-1', 'æ¢¦æ€é›¨')">æ¢¦æ€é›¨</button>
            <button onclick="selectName('name-1', 'ç‹é”¦çº¢')">ç‹é”¦çº¢</button>
            <button onclick="selectName('name-1', 'å“ä¹‰èŒ¹')">å“ä¹‰èŒ¹</button>
            <button onclick="selectName('name-1', 'æ•å§‘')">æ•å§‘</button>
            <button onclick="selectName('name-1', 'ç´å§‘')">ç´å§‘</button>
        </div>
        <textarea id="bets-1" placeholder="è¯·è¾“å…¥æ‚¨çš„æŠ•æ³¨å†…å®¹ï¼Œä¾‹å¦‚ï¼š
åŒ…3-5-7å°¾å„15ç±³æ–°
0123456789å°¾å„æ•°3ç±³æ–°
åŒ…0ã€8å°¾å„50ç±³07-43-23-35-47å„30ç±³æ–°
é¼ é¾™çŒ´å„15ç±³è›‡å„10ç±³æ—§
çº¢è“å„æ•°3ç±³æ–°
åŒå„æ•°3ç±³æ–°æ¾³é—¨"></textarea>
    </div>
</div>

<div class="winning-inputs">
    <div class="winning-group">
        <label>ğŸ² å¼€å¥–å·ç è®¾ç½®ï¼ˆ1-49ï¼‰ï¼š</label>
        <div class="winning-input-row">
            <div class="winning-type macau-bg">æ–°æ¾³</div>
            <input type="number" id="winning-macau" min="1" max="49" placeholder="è¯·è¾“å…¥æ–°æ¾³å¼€å¥–å·ç " />
        </div>
        <div class="winning-input-row">
            <div class="winning-type old-macau-bg">æ—§æ¾³</div>
            <input type="number" id="winning-old-macau" min="1" max="49" placeholder="è¯·è¾“å…¥æ—§æ¾³å¼€å¥–å·ç " />
        </div>
        <div class="winning-input-row">
            <div class="winning-type hongkong-bg">é¦™æ¸¯</div>
            <input type="number" id="winning-hongkong" min="1" max="49" placeholder="è¯·è¾“å…¥é¦™æ¸¯å¼€å¥–å·ç " />
        </div>
    </div>
    <div style="font-size: 14px; color: #666; margin-top: 8px;">
        ğŸ’¡ æç¤ºï¼šæ™®é€šæŠ•æ³¨ï¼ˆæœªæŒ‡å®šç±»å‹ï¼‰é»˜è®¤æŒ‰æ–°æ¾³è®¡ç®—ä¸­å¥–
    </div>
</div>

<div class="action-buttons">
    <button onclick="addUser()">â• æ·»åŠ ç”¨æˆ·</button>
    <button onclick="showResults()">ğŸ† ä¸­å¥–ç»“æœ</button>
    <button onclick="testSplit()">ğŸ§ª æµ‹è¯•æ‹†åˆ†</button>
    <button onclick="saveRecord()">ğŸ’¾ ä¿å­˜è®°å½•</button>
    <button onclick="showHistory()">ğŸ“š å†å²è®°å½•</button>
</div>

<div id="results-container">
    <div class="header">
        <h2>ğŸ† ä¸­å¥–ç»“æœ</h2>
        <p id="win-display-all">å¼€å¥–å·ç ï¼šæ–°æ¾³ ? | æ—§æ¾³ ? | é¦™æ¸¯ ?</p>
    </div>
    <p style="text-align:center; color:#999; margin-bottom:16px;" id="time-display"></p>
    <div id="results-inner"></div>
    <button onclick="hideResults()" class="back">â¬…ï¸ éšè—ç»“æœ</button>
</div>

<div id="history-container" class="history-section" style="display: none;">
    <div class="header">
        <h2>ğŸ“š å†å²è®°å½•</h2>
        <p>ä¿å­˜çš„ä¸­å¥–è®°å½•</p>
    </div>
    <div id="history-list"></div>
    <button onclick="hideHistory()" class="back">â¬…ï¸ è¿”å›</button>
</div>

<script>
// å°¾æ•°æ˜ å°„ï¼ˆ0-9å°¾ï¼‰
const TAIL = {
    0: [10, 20, 30, 40],
    1: [1, 11, 21, 31, 41],
    2: [2, 12, 22, 32, 42],
    3: [3, 13, 23, 33, 43],
    4: [4, 14, 24, 34, 44],
    5: [5, 15, 25, 35, 45],
    6: [6, 16, 26, 36, 46],
    7: [7, 17, 27, 37, 47],
    8: [8, 18, 28, 38, 48],
    9: [9, 19, 29, 39, 49]
};

// ä¿®æ­£åçš„ç”Ÿè‚–æ˜ å°„ï¼ˆæ ¹æ®ç”¨æˆ·æä¾›çš„2025å¹´ç”Ÿè‚–49ç å¯¹ç…§è¡¨ï¼‰
const ZODIAC = {
    å…”: [3, 15, 27, 39],
    é¾™: [2, 14, 26, 38],
    è›‡: [1, 13, 25, 37, 49],
    é©¬: [12, 24, 36, 48],
    ç¾Š: [11, 23, 35, 47],
    çŒ´: [10, 22, 34, 46],
    é¸¡: [9, 21, 33, 45],
    ç‹—: [8, 20, 32, 44],
    çŒª: [7, 19, 31, 43],
    é¼ : [6, 18, 30, 42],
    ç‰›: [5, 17, 29, 41],
    è™: [4, 16, 28, 40]
};

// çº¢è“ç»¿æ³¢æ˜ å°„
const COLOR_WAVE = {
    çº¢æ³¢: [1, 2, 7, 8, 12, 13, 18, 19, 23, 24, 29, 30, 34, 35, 40, 45, 46],
    è“æ³¢: [3, 4, 9, 10, 14, 15, 20, 25, 26, 31, 36, 37, 41, 42, 47, 48],
    ç»¿æ³¢: [5, 6, 11, 16, 17, 21, 22, 27, 28, 32, 33, 38, 39, 43, 44, 49]
};

// å•åŒæ˜ å°„
const PARITY = {
    å•: [1, 3, 5, 7, 9, 11, 13, 15, 17, 19, 21, 23, 25, 27, 29, 31, 33, 35, 37, 39, 41, 43, 45, 47, 49],
    åŒ: [2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 30, 32, 34, 36, 38, 40, 42, 44, 46, 48]
};

let userCount = 1;
let currentResults = null;
let editingRecordId = null;

// é€‰æ‹©ç”¨æˆ·å
function selectName(inputId, name) {
    document.getElementById(inputId).value = name;
}

// ä¸­æ–‡æ•°å­—è½¬é˜¿æ‹‰ä¼¯æ•°å­—å‡½æ•° - å¢å¼ºç‰ˆ
function chineseToNumber(chineseStr) {
    const chineseNumbers = {
        'é›¶': 0, 'ä¸€': 1, 'äºŒ': 2, 'ä¸‰': 3, 'å››': 4, 'äº”': 5,
        'å…­': 6, 'ä¸ƒ': 7, 'å…«': 8, 'ä¹': 9, 'å': 10,
        'ä¸¤': 2, 'ä¿©': 2, 'ç™¾': 100
    };
    
    // å¦‚æœæ˜¯å•ä¸ªæ•°å­—ï¼Œç›´æ¥è¿”å›
    if (chineseStr in chineseNumbers) {
        return chineseNumbers[chineseStr];
    }
    
    let result = 0;
    let temp = 0;
    
    for (let i = 0; i < chineseStr.length; i++) {
        const char = chineseStr[i];
        const num = chineseNumbers[char];
        
        if (num === 10) {
            // å¤„ç†"å"çš„æƒ…å†µ
            if (temp === 0) temp = 1;
            result += temp * 10;
            temp = 0;
        } else if (num === 100) {
            // å¤„ç†"ç™¾"çš„æƒ…å†µ
            if (temp === 0) temp = 1;
            result += temp * 100;
            temp = 0;
        } else if (num !== undefined) {
            temp = num;
        }
    }
    
    result += temp;
    return result || 1; // å¦‚æœè§£æå¤±è´¥ï¼Œè¿”å›é»˜è®¤å€¼1
}

// åˆå§‹åŒ–å†å²è®°å½•
function initHistory() {
    if (!localStorage.getItem('bettingHistory')) {
        localStorage.setItem('bettingHistory', JSON.stringify([]));
    }
}

// è·å–å†å²è®°å½•
function getHistory() {
    return JSON.parse(localStorage.getItem('bettingHistory') || '[]');
}

// ä¿å­˜å†å²è®°å½•
function saveHistory(history) {
    localStorage.setItem('bettingHistory', JSON.stringify(history));
}

// ä¿å­˜å½“å‰è®°å½•
function saveRecord() {
    if (!currentResults) {
        alert('è¯·å…ˆè®¡ç®—ä¸­å¥–ç»“æœï¼');
        return;
    }
    
    const history = getHistory();
    const record = {
        id: editingRecordId || Date.now(),
        timestamp: editingRecordId ? new Date().toLocaleString() + ' (å·²ç¼–è¾‘)' : new Date().toLocaleString(),
        winningNumbers: currentResults.winningNumbers,
        userData: currentResults.userData,
        totals: currentResults.totals
    };
    
    if (editingRecordId) {
        const index = history.findIndex(record => record.id === editingRecordId);
        if (index !== -1) {
            history[index] = record;
            alert('è®°å½•æ›´æ–°æˆåŠŸï¼');
        }
    } else {
        history.unshift(record);
        alert('è®°å½•ä¿å­˜æˆåŠŸï¼');
    }
    
    saveHistory(history);
    editingRecordId = null;
}

// åˆ é™¤è®°å½•
function deleteRecord(id) {
    if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ')) {
        return;
    }
    
    const history = getHistory();
    const updatedHistory = history.filter(record => record.id !== id);
    saveHistory(updatedHistory);
    showHistory();
}

// ç¼–è¾‘å†å²è®°å½•
function editRecord(id) {
    const history = getHistory();
    const record = history.find(r => r.id === id);
    
    if (!record) {
        alert('è®°å½•ä¸å­˜åœ¨ï¼');
        return;
    }
    
    editingRecordId = id;
    
    document.getElementById('winning-macau').value = record.winningNumbers.macau || '';
    document.getElementById('winning-old-macau').value = record.winningNumbers.oldMacau || '';
    document.getElementById('winning-hongkong').value = record.winningNumbers.hongkong || '';
    
    const container = document.getElementById('users-container');
    container.innerHTML = '';
    
    record.userData.forEach((user, index) => {
        const userCard = document.createElement('div');
        userCard.className = 'user-card';
        userCard.id = `user-${index + 1}`;
        userCard.innerHTML = `
            <div class="user-header">
                <input type="text" id="name-${index + 1}" value="${user.name}" placeholder="è¾“å…¥ç”¨æˆ·å" />
            </div>
            <div class="name-selector">
                <button onclick="selectName('name-${index + 1}', 'é»„å®Œ')">é»„å®Œ</button>
                <button onclick="selectName('name-${index + 1}', 'é»„å±•æ¨¡')">é»„å±•æ¨¡</button>
                <button onclick="selectName('name-${index + 1}', 'è‡ªå·±')">è‡ªå·±</button>
                <button onclick="selectName('name-${index + 1}', 'å››å¦¹')">å››å¦¹</button>
                <button onclick="selectName('name-${index + 1}', 'é»„å®Œå®¶å©†')">é»„å®Œå®¶å©†</button>
                <button onclick="selectName('name-${index + 1}', 'æ–¹ä¸š')">æ–¹ä¸š</button>
                <button onclick="selectName('name-${index + 1}', 'é£å…°')">é£å…°</button>
                <button onclick="selectName('name-${index + 1}', 'æ¢¦æ€é›¨')">æ¢¦æ€é›¨</button>
                <button onclick="selectName('name-${index + 1}', 'ç‹é”¦çº¢')">ç‹é”¦çº¢</button>
                <button onclick="selectName('name-${index + 1}', 'å“ä¹‰èŒ¹')">å“ä¹‰èŒ¹</button>
                <button onclick="selectName('name-${index + 1}', 'æ•å§‘')">æ•å§‘</button>
                <button onclick="selectName('name-${index + 1}', 'ç´å§‘')">ç´å§‘</button>
            </div>
            <textarea id="bets-${index + 1}" placeholder="è¾“å…¥æŠ•æ³¨å†…å®¹">${user.bets}</textarea>
        `;
        container.appendChild(userCard);
    });
    
    userCount = record.userData.length;
    
    hideHistory();
    showResults();
}

// æ˜¾ç¤ºå†å²è®°å½•
function showHistory() {
    const history = getHistory();
    const container = document.getElementById('history-container');
    const list = document.getElementById('history-list');
    
    if (history.length === 0) {
        list.innerHTML = '<p style="text-align:center; color:#999; padding:20px;">æš‚æ— å†å²è®°å½•</p>';
    } else {
        list.innerHTML = history.map(record => `
            <div class="history-item">
                <div class="history-header">
                    <strong>è®°å½• #${record.id}</strong>
                    <span class="history-time">${record.timestamp}</span>
                </div>
                <div class="history-numbers">
                    ${getWinningDisplay(record.winningNumbers)}
                </div>
                <div>
                    <strong>ç”¨æˆ·æ•°é‡:</strong> ${record.userData.length} äºº<br>
                    <strong>æ€»æŠ•å…¥:</strong> <span class="money-blue">${record.totals.totalCost} å…ƒ</span><br>
                    <strong>æ€»ä¸­å¥–:</strong> <span class="money-red">${record.totals.totalWin} å…ƒ</span><br>
                    <strong>æ€»åˆ©æ¶¦:</strong> <span class="${record.totals.totalProfit >= 0 ? 'money-red' : ''}">${record.totals.totalProfit >= 0 ? '+' : ''}${record.totals.totalProfit}</span> <span class="money-red">å…ƒ</span><br>
                    <strong>ç´¯è®¡ä¸­å¥–æŠ•æ³¨:</strong> <span class="money-red">${record.totals.totalBetWin} å…ƒ</span>
                </div>
                <div class="history-actions">
                    <button onclick="loadRecord(${record.id})" style="background: #19be6b;">ğŸ“Š æŸ¥çœ‹è¯¦æƒ…</button>
                    <button onclick="editRecord(${record.id})" class="edit-history-btn">âœï¸ ç¼–è¾‘</button>
                    <button onclick="deleteRecord(${record.id})" class="delete">ğŸ—‘ï¸ åˆ é™¤</button>
                </div>
            </div>
        `).join('');
    }
    
    document.getElementById('results-container').style.display = 'none';
    container.style.display = 'block';
}

// åŠ è½½è®°å½•è¯¦æƒ…
function loadRecord(id) {
    const history = getHistory();
    const record = history.find(r => r.id === id);
    
    if (!record) {
        alert('è®°å½•ä¸å­˜åœ¨ï¼');
        return;
    }
    
    document.getElementById('winning-macau').value = record.winningNumbers.macau || '';
    document.getElementById('winning-old-macau').value = record.winningNumbers.oldMacau || '';
    document.getElementById('winning-hongkong').value = record.winningNumbers.hongkong || '';
    
    const container = document.getElementById('users-container');
    container.innerHTML = '';
    
    record.userData.forEach((user, index) => {
        const userCard = document.createElement('div');
        userCard.className = 'user-card';
        userCard.id = `user-${index + 1}`;
        userCard.innerHTML = `
            <div class="user-header">
                <input type="text" id="name-${index + 1}" value="${user.name}" placeholder="è¾“å…¥ç”¨æˆ·å" />
            </div>
            <div class="name-selector">
                <button onclick="selectName('name-${index + 1}', 'é»„å®Œ')">é»„å®Œ</button>
                <button onclick="selectName('name-${index + 1}', 'é»„å±•æ¨¡')">é»„å±•æ¨¡</button>
                <button onclick="selectName('name-${index + 1}', 'è‡ªå·±')">è‡ªå·±</button>
                <button onclick="selectName('name-${index + 1}', 'å››å¦¹')">å››å¦¹</button>
                <button onclick="selectName('name-${index + 1}', 'é»„å®Œå®¶å©†')">é»„å®Œå®¶å©†</button>
                <button onclick="selectName('name-${index + 1}', 'æ–¹ä¸š')">æ–¹ä¸š</button>
                <button onclick="selectName('name-${index + 1}', 'é£å…°')">é£å…°</button>
                <button onclick="selectName('name-${index + 1}', 'æ¢¦æ€é›¨')">æ¢¦æ€é›¨</button>
                <button onclick="selectName('name-${index + 1}', 'ç‹é”¦çº¢')">ç‹é”¦çº¢</button>
                <button onclick="selectName('name-${index + 1}', 'å“ä¹‰èŒ¹')">å“ä¹‰èŒ¹</button>
                <button onclick="selectName('name-${index + 1}', 'æ•å§‘')">æ•å§‘</button>
                <button onclick="selectName('name-${index + 1}', 'ç´å§‘')">ç´å§‘</button>
            </div>
            <textarea id="bets-${index + 1}" placeholder="è¾“å…¥æŠ•æ³¨å†…å®¹">${user.bets}</textarea>
        `;
        container.appendChild(userCard);
    });
    
    userCount = record.userData.length;
    
    hideHistory();
    showResults();
}

// éšè—å†å²è®°å½•
function hideHistory() {
    document.getElementById('history-container').style.display = 'none';
}

function addUser() {
    userCount++;
    const container = document.getElementById('users-container');
    const newUserCard = document.createElement('div');
    newUserCard.className = 'user-card';
    newUserCard.id = `user-${userCount}`;
    newUserCard.innerHTML = `
        <div class="user-header">
            <input type="text" id="name-${userCount}" placeholder="è¾“å…¥ç”¨æˆ·å" />
        </div>
        <div class="name-selector">
            <button onclick="selectName('name-${userCount}', 'é»„å®Œ')">é»„å®Œ</button>
            <button onclick="selectName('name-${userCount}', 'é»„å±•æ¨¡')">é»„å±•æ¨¡</button>
            <button onclick="selectName('name-${userCount}', 'è‡ªå·±')">è‡ªå·±</button>
            <button onclick="selectName('name-${userCount}', 'å››å¦¹')">å››å¦¹</button>
            <button onclick="selectName('name-${userCount}', 'é»„å®Œå®¶å©†')">é»„å®Œå®¶å©†</button>
            <button onclick="selectName('name-${userCount}', 'æ–¹ä¸š')">æ–¹ä¸š</button>
            <button onclick="selectName('name-${userCount}', 'é£å…°')">é£å…°</button>
            <button onclick="selectName('name-${userCount}', 'æ¢¦æ€é›¨')">æ¢¦æ€é›¨</button>
            <button onclick="selectName('name-${userCount}', 'ç‹é”¦çº¢')">ç‹é”¦çº¢</button>
            <button onclick="selectName('name-${userCount}', 'å“ä¹‰èŒ¹')">å“ä¹‰èŒ¹</button>
            <button onclick="selectName('name-${userCount}', 'æ•å§‘')">æ•å§‘</button>
            <button onclick="selectName('name-${userCount}', 'ç´å§‘')">ç´å§‘</button>
        </div>
        <textarea id="bets-${userCount}" placeholder="è¾“å…¥æŠ•æ³¨å†…å®¹"></textarea>
    `;
    container.appendChild(newUserCard);
}

// æ ¹æ®å·ç è¿”å› ç”Ÿè‚–+æ•°å­—ï¼Œä¾‹å¦‚ "å…”10"
function getZodiacLabel(num) {
    for (const [zodiac, nums] of Object.entries(ZODIAC)) {
        if (nums.includes(num)) {
            return `${zodiac}${num}`;
        }
    }
    return num.toString();
}

// è·å–ç”Ÿè‚–æ˜¾ç¤ºæ–‡æœ¬ï¼ˆä¾‹å¦‚ï¼š26ï¼ˆé¾™ï¼‰ï¼‰
function getZodiacDisplay(num) {
    for (const [zodiac, nums] of Object.entries(ZODIAC)) {
        if (nums.includes(num)) {
            return `${num}ï¼ˆ${zodiac}ï¼‰`;
        }
    }
    return num.toString();
}

// è·å–ä»Šæ—¥ç”Ÿè‚–æ˜¾ç¤ºæ–‡æœ¬
function getTodayZodiacDisplay(winningNumbers) {
    const parts = [];
    if (winningNumbers.macau) parts.push(`æ–°æ¾³${getZodiacDisplay(winningNumbers.macau)}`);
    if (winningNumbers.oldMacau) parts.push(`æ—§æ¾³${getZodiacDisplay(winningNumbers.oldMacau)}`);
    if (winningNumbers.hongkong) parts.push(`é¦™æ¸¯${getZodiacDisplay(winningNumbers.hongkong)}`);
    return parts.join(' ') || 'æ— å¼€å¥–å·ç ';
}

// æ™ºèƒ½æ–­å¥ï¼šæ”¹è¿›çš„æ‹†åˆ†é€»è¾‘
function splitBetsByAmount(text) {
    const lines = [];
    const rawLines = text.split('\n').filter(line => line.trim());
    
    for (const rawLine of rawLines) {
        const cleanLine = rawLine.trim();
        if (!cleanLine) continue;
        
        console.log("å¤„ç†è¡Œ:", cleanLine);
        
        const segments = [];
        
        // å¢å¼ºçš„é‡‘é¢åŒ¹é…ï¼šæ”¯æŒä¸­æ–‡æ•°å­—ã€é˜¿æ‹‰ä¼¯æ•°å­—å’Œå„ç§æ ¼å¼
        const amountPattern = /(?:å„(?:æ•°)?|åŒ…)\s*(?:[\dä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åä¸¤ä¿©ç™¾]+\s*(?:ç±³|å…ƒ)?|[\dä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åä¸¤ä¿©ç™¾]+\s*å°¾\s*[\dä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åä¸¤ä¿©ç™¾]+\s*(?:ç±³|å…ƒ)?)/g;
        const amountMatches = [...cleanLine.matchAll(amountPattern)];
        
        console.log("æ‰¾åˆ°é‡‘é¢æ ‡è®°:", amountMatches);
        
        if (amountMatches.length === 0) {
            segments.push(cleanLine);
        } else {
            let lastIndex = 0;
            amountMatches.forEach((match, index) => {
                const matchIndex = match.index;
                const matchText = match[0];
                
                console.log(`å¤„ç†åŒ¹é… ${index}: ä½ç½®=${matchIndex}, æ–‡æœ¬=${matchText}`);
                
                if (matchIndex > lastIndex) {
                    const segment = cleanLine.substring(lastIndex, matchIndex + matchText.length).trim();
                    if (segment) {
                        segments.push(segment);
                        console.log(`æ·»åŠ æ®µè½åˆ°ä½ç½® ${matchIndex + matchText.length}: ${segment}`);
                    }
                } else if (matchIndex === 0) {
                    const segment = cleanLine.substring(0, matchText.length).trim();
                    if (segment) {
                        segments.push(segment);
                        console.log(`æ·»åŠ è¡Œé¦–æ®µè½: ${segment}`);
                    }
                }
                lastIndex = matchIndex + matchText.length;
                
                if (index === amountMatches.length - 1 && lastIndex < cleanLine.length) {
                    const remaining = cleanLine.substring(lastIndex).trim();
                    if (remaining) {
                        console.log(`æ·»åŠ å‰©ä½™å†…å®¹: ${remaining}`);
                        if (segments.length > 0) {
                            segments[segments.length - 1] += ' ' + remaining;
                            console.log(`é™„åŠ åˆ°æœ€åä¸€ä¸ªæ®µè½: ${segments[segments.length - 1]}`);
                        } else {
                            segments.push(remaining);
                        }
                    }
                }
            });
        }
        
        segments.forEach(segment => {
            if (segment.trim()) {
                lines.push(segment.trim());
                console.log("æœ€ç»ˆæ·»åŠ è¡Œ:", segment.trim());
            }
        });
    }
    
    console.log("æœ€ç»ˆæ‹†åˆ†ç»“æœ:", lines);
    return lines;
}

// åˆ¤æ–­æŠ•æ³¨ç±»å‹
function getBetType(line) {
    const clean = line.trim();
    if (/é¦™æ¸¯/.test(clean)) return 'hongkong';
    if (/æ¾³é—¨|æ–°æ¾³|æ–°/.test(clean)) return 'macau';
    if (/æ—§/.test(clean)) return 'old-macau';
    if (/^æ–°\s*[.\s]?\s*\d/.test(clean)) return 'macau';
    if (/å„(?:æ•°)?\s*\d+\s*(?:ç±³|å…ƒ)?\s+æ–°\s+[^\d]/.test(clean)) return 'macau';
    if (/å„(?:æ•°)?\s*\d+\s*(?:ç±³|å…ƒ)?\s+æ—§\s+[^\d]/.test(clean)) return 'old-macau';
    return 'normal';
}

// è·å–æŠ•æ³¨ç±»å‹æ ‡ç­¾
function getBetTypeLabel(betType) {
    switch(betType) {
        case 'hongkong': return '<span class="bet-type hongkong">é¦™æ¸¯</span>';
        case 'macau': return '<span class="bet-type macau">æ¾³é—¨</span>';
        case 'old-macau': return '<span class="bet-type old-macau">æ—§æ¾³é—¨</span>';
        default: return '<span class="bet-type normal">æ™®é€š</span>';
    }
}

// æå–æ•°å­—çš„è¾…åŠ©å‡½æ•°
function extractDigitsFromText(text) {
    const digits = [];
    
    // åŒ¹é…é˜¿æ‹‰ä¼¯æ•°å­—
    const arabicDigits = text.match(/\d/g);
    if (arabicDigits) {
        arabicDigits.forEach(d => {
            const digit = parseInt(d);
            if (digit >= 0 && digit <= 9) digits.push(digit);
        });
    }
    
    // åŒ¹é…ä¸­æ–‡æ•°å­—
    const chineseDigits = text.match(/[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åä¸¤ä¿©]/g);
    if (chineseDigits) {
        chineseDigits.forEach(d => {
            const digit = chineseToNumber(d);
            if (digit >= 0 && digit <= 9) digits.push(digit);
        });
    }
    
    return digits;
}

// é‡å†™å°¾æ•°è§£æå‡½æ•° - ä¿®å¤ç‚¹å·å°¾æ•°é‡å¤é—®é¢˜
function parseTailNumbers(text) {
    const nums = [];
    console.log("å°¾æ•°è§£ææ–‡æœ¬:", text);
    
    // 1. ç‚¹å·å°¾æ•°æ ¼å¼ï¼ˆ1.2.3å°¾ï¼‰ - ä¿®å¤ç‰ˆ
    const dotTailMatch = text.match(/(\d+(?:\.\d+)*)å°¾/);
    if (dotTailMatch) {
        const bases = dotTailMatch[1].split('.').map(n => parseInt(n, 10));
        console.log("æ‰¾åˆ°ç‚¹å·å°¾æ•°æ ¼å¼, å°¾æ•°:", bases);
        
        // ç›´æ¥æ”¶é›†è¿™äº›å°¾æ•°å¯¹åº”çš„æ‰€æœ‰å·ç 
        bases.forEach(base => {
            if (base >= 0 && base <= 9 && TAIL[base]) {
                // åªæ·»åŠ å°¾æ•°å¯¹åº”çš„å·ç 
                TAIL[base].forEach(n => {
                    if (!nums.includes(n)) {
                        nums.push(n);
                    }
                });
                console.log(`å°¾æ•° ${base} å¯¹åº”çš„å·ç :`, TAIL[base]);
            }
        });
        
        console.log("ç‚¹å·å°¾æ•°æ ¼å¼è§£æç»“æœ:", nums);
        return nums;
    }
    
    // 2. å°¾åŒ…Xæ ¼å¼ï¼ˆä¸­æ–‡æˆ–æ•°å­—ï¼‰
    const tailPackMatch = text.match(/å°¾\s*åŒ…\s*([\dä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åä¸¤ä¿©ç™¾\s\-ã€,ï¼Œ.]+)/);
    if (tailPackMatch) {
        const tailPart = tailPackMatch[1];
        console.log("æ‰¾åˆ°å°¾åŒ…æ ¼å¼:", tailPart);
        
        const digits = extractDigitsFromText(tailPart);
        digits.forEach(digit => {
            if (digit >= 0 && digit <= 9 && TAIL[digit]) {
                TAIL[digit].forEach(n => {
                    if (!nums.includes(n)) {
                        nums.push(n);
                    }
                });
            }
        });
        
        console.log("å°¾åŒ…æ ¼å¼è§£æç»“æœ:", nums);
        return nums;
    }
    
    // 3. åŒ…Xå°¾æ ¼å¼ï¼ˆä¸­æ–‡æˆ–æ•°å­—ï¼‰
    const packTailMatch = text.match(/åŒ…\s*([\dä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åä¸¤ä¿©ç™¾\s\-ã€,ï¼Œ.]+)\s*å°¾/);
    if (packTailMatch && !text.includes('å°¾åŒ…')) {
        const tailPart = packTailMatch[1];
        console.log("æ‰¾åˆ°åŒ…å°¾æ ¼å¼:", tailPart);
        
        const digits = extractDigitsFromText(tailPart);
        digits.forEach(digit => {
            if (digit >= 0 && digit <= 9 && TAIL[digit]) {
                TAIL[digit].forEach(n => {
                    if (!nums.includes(n)) {
                        nums.push(n);
                    }
                });
            }
        });
        
        console.log("åŒ…å°¾æ ¼å¼è§£æç»“æœ:", nums);
        return nums;
    }
    
    // 4. è¿ç»­å°¾æ•°æ ¼å¼ï¼ˆ123å°¾ï¼‰
    const continuousTailMatch = text.match(/(\d+)\s*å°¾/);
    if (continuousTailMatch && !text.includes('åŒ…') && !text.includes('.') && !text.includes('å°¾åŒ…')) {
        const digitsStr = continuousTailMatch[1];
        console.log("æ‰¾åˆ°è¿ç»­å°¾æ•°æ ¼å¼:", digitsStr);
        
        const digits = digitsStr.split('').map(d => parseInt(d));
        digits.forEach(digit => {
            if (digit >= 0 && digit <= 9 && TAIL[digit]) {
                TAIL[digit].forEach(n => {
                    if (!nums.includes(n)) {
                        nums.push(n);
                    }
                });
            }
        });
        
        console.log("è¿ç»­å°¾æ•°æ ¼å¼è§£æç»“æœ:", nums);
        return nums;
    }
    
    console.log("å°¾æ•°è§£æç»“æœ:", nums);
    return nums;
}

// æå–é‡‘é¢ - ä¿®å¤ç‰ˆï¼šæ­£ç¡®è¯†åˆ«"åŒ…X"ä½œä¸ºé‡‘é¢
function extractAmount(line) {
    console.log("è§£æé‡‘é¢:", line);
    
    // 1. ä¼˜å…ˆåŒ¹é…"åŒ…X"æ ¼å¼ï¼ˆé˜¿æ‹‰ä¼¯æ•°å­—ï¼‰- å¿…é¡»æ˜¯ç‹¬ç«‹çš„"åŒ…X"ï¼Œä¸èƒ½æ˜¯"åŒ…Xå°¾"
    let match = line.match(/åŒ…\s*(\d+)\s*(?:ç±³|å…ƒ)?(?=\s|$|æ–°|æ—§|é¦™æ¸¯|æ¾³é—¨)/i);
    if (match) {
        // æ£€æŸ¥åé¢æ˜¯å¦æœ‰"å°¾"å­—
        const checkTail = line.substring(match.index + match[0].length);
        if (!checkTail.includes("å°¾")) {
            console.log("åŒ¹é…åŒ…Xæ ¼å¼ï¼ˆé˜¿æ‹‰ä¼¯æ•°å­—ï¼‰:", match[1]);
            return parseInt(match[1]);
        }
    }
    
    // 2. ä¼˜å…ˆåŒ¹é…"åŒ…X"æ ¼å¼ï¼ˆä¸­æ–‡æ•°å­—ï¼‰- å¿…é¡»æ˜¯ç‹¬ç«‹çš„"åŒ…X"ï¼Œä¸èƒ½æ˜¯"åŒ…Xå°¾"
    match = line.match(/åŒ…\s*([ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åä¸¤ä¿©ç™¾]+)\s*(?:ç±³|å…ƒ)?(?=\s|$|æ–°|æ—§|é¦™æ¸¯|æ¾³é—¨)/i);
    if (match) {
        // æ£€æŸ¥åé¢æ˜¯å¦æœ‰"å°¾"å­—
        const checkTail = line.substring(match.index + match[0].length);
        if (!checkTail.includes("å°¾")) {
            const chineseNum = match[1];
            console.log("åŒ¹é…åŒ…Xæ ¼å¼ï¼ˆä¸­æ–‡æ•°å­—ï¼‰:", chineseNum);
            return chineseToNumber(chineseNum);
        }
    }
    
    // 3. å°è¯•åŒ¹é…æ ‡å‡†çš„"å„Xç±³"æ ¼å¼ï¼ˆé˜¿æ‹‰ä¼¯æ•°å­—ï¼‰
    match = line.match(/å„(?:æ•°)?\s*(\d+)\s*(?:ç±³|å…ƒ)/i);
    if (match) {
        console.log("åŒ¹é…æ ‡å‡†æ ¼å¼ï¼ˆé˜¿æ‹‰ä¼¯æ•°å­—ï¼‰:", match[1]);
        return parseInt(match[1]);
    }
    
    // 4. å°è¯•åŒ¹é…æ ‡å‡†çš„"å„Xç±³"æ ¼å¼ï¼ˆä¸­æ–‡æ•°å­—ï¼‰
    match = line.match(/å„(?:æ•°)?\s*([ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åä¸¤ä¿©ç™¾]+)\s*(?:ç±³|å…ƒ)?/);
    if (match) {
        const chineseNum = match[1];
        console.log("åŒ¹é…æ ‡å‡†æ ¼å¼ï¼ˆä¸­æ–‡æ•°å­—ï¼‰:", chineseNum);
        return chineseToNumber(chineseNum);
    }
    
    // 5. ä¿®å¤ï¼šåŒ¹é…"ç±³"å‰é¢çš„æ•°å­—
    match = line.match(/(\d+)\s*(?:ç±³|å…ƒ)(?!\d)/);
    if (match) {
        console.log("åŒ¹é…ç±³å‰æ•°å­—:", match[1]);
        return parseInt(match[1]);
    }
    
    // 6. ä¿®å¤ï¼šåŒ¹é…"å„X"æ ¼å¼ï¼ˆæ²¡æœ‰ç±³å­—ï¼‰
    match = line.match(/å„(?:æ•°)?\s*(\d+)(?=\s|$|æ–°|æ—§|é¦™æ¸¯|æ¾³é—¨)/i);
    if (match) {
        console.log("åŒ¹é…æ— ç±³æ ¼å¼ï¼ˆé˜¿æ‹‰ä¼¯æ•°å­—ï¼‰:", match[1]);
        return parseInt(match[1]);
    }
    
    // 7. ä¿®å¤ï¼šåŒ¹é…"å„X"æ ¼å¼ï¼ˆä¸­æ–‡æ•°å­—ï¼Œæ²¡æœ‰ç±³å­—ï¼‰
    match = line.match(/å„(?:æ•°)?\s*([ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åä¸¤ä¿©ç™¾]+)(?=\s|$|æ–°|æ—§|é¦™æ¸¯|æ¾³é—¨)/i);
    if (match) {
        const chineseNum = match[1];
        console.log("åŒ¹é…æ— ç±³æ ¼å¼ï¼ˆä¸­æ–‡æ•°å­—ï¼‰:", chineseNum);
        return chineseToNumber(chineseNum);
    }
    
    // 8. ä¿®å¤ï¼šåŒ¹é…è¿å­—ç¬¦åˆ†éš”çš„é‡‘é¢
    match = line.match(/(\d+)\s*[-â€“â€”]\s*(\d+)\s*(?:ç±³|å…ƒ)/);
    if (match) {
        console.log("åŒ¹é…è¿å­—ç¬¦:", match[2]);
        return parseInt(match[2]);
    }
    
    console.log("æœªåŒ¹é…åˆ°é‡‘é¢ï¼Œä½¿ç”¨é»˜è®¤å€¼1");
    return 1;
}

// è·å–æ’é™¤é‡‘é¢åçš„æ–‡æœ¬ - æ–°å¢å‡½æ•°
function getTextExcludingAmount(text) {
    let result = text;
    
    // ç§»é™¤"åŒ…X"é‡‘é¢ï¼ˆä½†ä¿ç•™"åŒ…Xå°¾"ï¼‰
    result = result.replace(/åŒ…\s*[\dä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åä¸¤ä¿©ç™¾]+\s*(?:ç±³|å…ƒ)?(?=\s|$|æ–°|æ—§|é¦™æ¸¯|æ¾³é—¨)/gi, '');
    
    // ç§»é™¤"å„Xç±³"é‡‘é¢
    result = result.replace(/å„(?:æ•°)?\s*[\dä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åä¸¤ä¿©ç™¾]+\s*(?:ç±³|å…ƒ)?/gi, '');
    
    // ç§»é™¤å•ç‹¬çš„æ•°å­—+ç±³/å…ƒ
    result = result.replace(/(\d+)\s*(?:ç±³|å…ƒ)(?!\d)/g, '');
    
    return result.trim();
}

// è§£æå·ç ï¼ˆä¿®å¤ç‰ˆï¼‰- åŒºåˆ†å°¾æ•°æŠ•æ³¨å’Œç›´æ¥å·ç æŠ•æ³¨ï¼Œè§£å†³é‡å¤é—®é¢˜
function parseNumbers(text) {
    const nums = [];
    console.log("å¼€å§‹è§£æå·ç :", text);

    const amount = extractAmount(text);
    console.log("æå–åˆ°çš„é‡‘é¢:", amount);
    
    // è·å–æ’é™¤é‡‘é¢åçš„æ–‡æœ¬è¿›è¡Œå·ç è§£æ
    const cleanedText = getTextExcludingAmount(text);
    console.log("æ’é™¤é‡‘é¢åçš„æ–‡æœ¬:", cleanedText);
    
    // åˆ¤æ–­æ˜¯å¦æ˜¯å°¾æ•°æŠ•æ³¨ï¼ˆåŒ…å«"å°¾"å­—ä¸”æ˜¯å°¾æ•°æŠ•æ³¨æ ¼å¼ï¼‰
    const isTailBet = cleanedText.includes('å°¾') && 
                     (cleanedText.includes('åŒ…') || 
                      cleanedText.includes('å„') || 
                      /å°¾.*åŒ…|åŒ….*å°¾/.test(cleanedText));
    
    console.log("æ˜¯å¦æ˜¯å°¾æ•°æŠ•æ³¨:", isTailBet);
    
    // å¦‚æœæ˜¯ç‚¹å·å°¾æ•°æ ¼å¼ï¼ˆå¦‚1.2.3å°¾ï¼‰ï¼Œç›´æ¥è°ƒç”¨å°¾æ•°è§£æå‡½æ•°
    const isDotTailBet = /(\d+(?:\.\d+)*)å°¾/.test(cleanedText);
    console.log("æ˜¯å¦æ˜¯ç‚¹å·å°¾æ•°æ ¼å¼:", isDotTailBet);
    
    if (isDotTailBet) {
        // ç‚¹å·å°¾æ•°æ ¼å¼ï¼šåªè§£æå°¾æ•°ï¼Œä¸æ·»åŠ å…¶ä»–å·ç 
        const tailNumbers = parseTailNumbers(cleanedText);
        tailNumbers.forEach(n => {
            if (!nums.includes(n)) {
                nums.push(n);
            }
        });
        console.log("ç‚¹å·å°¾æ•°æ ¼å¼æœ€ç»ˆè§£æç»“æœ:", nums);
        return nums;
    }
    
    // 1. å¦‚æœæ˜¯å…¶ä»–å°¾æ•°æŠ•æ³¨ï¼Œä½¿ç”¨å°¾æ•°è§£æ
    if (isTailBet) {
        // å…¶ä»–å°¾æ•°æŠ•æ³¨ï¼šåªè§£æå°¾æ•°
        const tailNumbers = parseTailNumbers(cleanedText);
        tailNumbers.forEach(n => {
            if (!nums.includes(n)) {
                nums.push(n);
            }
        });
        
        console.log("å…¶ä»–å°¾æ•°æŠ•æ³¨è§£æç»“æœ:", nums);
        return nums;
    }
    
    // 2. éå°¾æ•°æŠ•æ³¨ï¼Œè§£ææ‰€æœ‰ç±»å‹å·ç 
    // å…ˆè§£æç›´æ¥å·ç ï¼ˆä¿ç•™é‡å¤ï¼‰
    const numMatches = cleanedText.match(/\b\d{1,2}\b/g);
    if (numMatches) {
        console.log("æ‰¾åˆ°çš„ç›´æ¥å·ç :", numMatches);
        numMatches.forEach(numStr => {
            const n = parseInt(numStr);
            if (n >= 1 && n <= 49) {
                console.log(`æ·»åŠ ç›´æ¥å·ç : ${n}`);
                nums.push(n); // ç›´æ¥å·ç ä¿ç•™é‡å¤
            }
        });
    }
    
    // è§£æå°¾æ•°æ ¼å¼ï¼ˆéç‚¹å·æ ¼å¼ï¼‰
    const tailNumbers = parseTailNumbers(cleanedText);
    tailNumbers.forEach(n => {
        if (!nums.includes(n)) {
            nums.push(n);
            console.log(`æ·»åŠ å°¾æ•°æ ¼å¼å·ç : ${n}`);
        }
    });
    
    // è§£æç”Ÿè‚–
    for (const [zodiac, zodiacNumbers] of Object.entries(ZODIAC)) {
        if (cleanedText.includes(zodiac)) {
            console.log(`æ‰¾åˆ°ç”Ÿè‚–: ${zodiac}`);
            zodiacNumbers.forEach(n => {
                if (!nums.includes(n)) {
                    nums.push(n);
                }
            });
        }
    }
    
    // è§£æé¢œè‰²æ³¢
    const colorKeywords = {
        'çº¢': 'çº¢æ³¢',
        'è“': 'è“æ³¢', 
        'ç»¿': 'ç»¿æ³¢',
        'çº¢æ³¢': 'çº¢æ³¢',
        'è“æ³¢': 'è“æ³¢',
        'ç»¿æ³¢': 'ç»¿æ³¢'
    };
    
    for (const [keyword, colorKey] of Object.entries(colorKeywords)) {
        if (cleanedText.includes(keyword)) {
            console.log(`æ‰¾åˆ°é¢œè‰²: ${keyword} -> ${colorKey}`);
            COLOR_WAVE[colorKey].forEach(n => {
                if (!nums.includes(n)) {
                    nums.push(n);
                }
            });
        }
    }
    
    // è§£æå•åŒ
    for (const [parityType, parityNumbers] of Object.entries(PARITY)) {
        if (cleanedText.includes(parityType)) {
            console.log(`æ‰¾åˆ°å•åŒ: ${parityType}`);
            parityNumbers.forEach(n => {
                if (!nums.includes(n)) {
                    nums.push(n);
                }
            });
        }
    }
    
    console.log("æœ€ç»ˆè§£æçš„å·ç :", nums);
    return nums;
}

// è·å–æ‰€æœ‰å¼€å¥–å·ç 
function getWinningNumbers() {
    const winningNumbers = {};
    
    const macauNum = document.getElementById('winning-macau').value.trim();
    const oldMacauNum = document.getElementById('winning-old-macau').value.trim();
    const hongkongNum = document.getElementById('winning-hongkong').value.trim();
    
    if (macauNum) {
        const num = parseInt(macauNum);
        if (num >= 1 && num <= 49) {
            winningNumbers.macau = num;
        }
    }
    
    if (oldMacauNum) {
        const num = parseInt(oldMacauNum);
        if (num >= 1 && num <= 49) {
            winningNumbers.oldMacau = num;
        }
    }
    
    if (hongkongNum) {
        const num = parseInt(hongkongNum);
        if (num >= 1 && num <= 49) {
            winningNumbers.hongkong = num;
        }
    }
    
    return winningNumbers;
}

// æ£€æŸ¥æŠ•æ³¨æ˜¯å¦ä¸­å¥–
function checkWin(betType, numbers, winningNumbers) {
    switch(betType) {
        case 'macau':
            return winningNumbers.macau && numbers.includes(winningNumbers.macau);
        case 'old-macau':
            return winningNumbers.oldMacau && numbers.includes(winningNumbers.oldMacau);
        case 'hongkong':
            return winningNumbers.hongkong && numbers.includes(winningNumbers.hongkong);
        case 'normal':
            return winningNumbers.macau && numbers.includes(winningNumbers.macau);
        default:
            return false;
    }
}

// è·å–ä¸­å¥–é‡‘é¢
function getWinAmount(betType, perBet, numbers, winningNumbers) {
    let winAmount = 0;
    
    if (checkWin(betType, numbers, winningNumbers)) {
        winAmount = perBet * 47;
    }
    
    return winAmount;
}

// è·å–å¼€å¥–æ˜¾ç¤ºæ–‡æœ¬
function getWinningDisplay(winningNumbers) {
    const parts = [];
    if (winningNumbers.macau) parts.push(`æ–°æ¾³ ${getZodiacLabel(winningNumbers.macau)}`);
    if (winningNumbers.oldMacau) parts.push(`æ—§æ¾³ ${getZodiacLabel(winningNumbers.oldMacau)}`);
    if (winningNumbers.hongkong) parts.push(`é¦™æ¸¯ ${getZodiacLabel(winningNumbers.hongkong)}`);
    return parts.join(' | ') || 'æ— æœ‰æ•ˆå¼€å¥–å·ç ';
}

// å¤„ç†æ–°æ—§åŒæ—¶å‡ºç°çš„æŠ•æ³¨
function processNewOldBets(lines) {
    const processedLines = [];
    
    lines.forEach(line => {
        const trimmedLine = line.trim();
        if (!trimmedLine) return;
        
        if (trimmedLine.includes('æ–°') && trimmedLine.includes('æ—§')) {
            console.log("æ£€æµ‹åˆ°æ–°æ—§åŒæ—¶å‡ºç°ï¼Œè‡ªåŠ¨æ‹†åˆ†:", trimmedLine);
            
            const newLine = trimmedLine.replace(/æ—§/g, '').trim();
            const oldLine = trimmedLine.replace(/æ–°/g, '').trim();
            
            processedLines.push({
                line: newLine,
                betType: 'macau',
                originalLine: trimmedLine,
                isSplit: true,
                splitType: 'æ–°æ¾³'
            });
            
            processedLines.push({
                line: oldLine,
                betType: 'old-macau',
                originalLine: trimmedLine,
                isSplit: true,
                splitType: 'æ—§æ¾³'
            });
        } else {
            processedLines.push({
                line: trimmedLine,
                betType: null,
                originalLine: trimmedLine,
                isSplit: false
            });
        }
    });
    
    return processedLines;
}

function showResults() {
    const winningNumbers = getWinningNumbers();
    
    if (!winningNumbers.macau) {
        return alert('è¯·è‡³å°‘è¾“å…¥æ–°æ¾³å¼€å¥–å·ç ï¼æ™®é€šæŠ•æ³¨éœ€è¦æ–°æ¾³å¼€å¥–å·ç æ¥è®¡ç®—ä¸­å¥–ã€‚');
    }

    const userData = [];
    const container = document.getElementById('users-container');
    const userCards = container.querySelectorAll('.user-card');

    userCards.forEach(card => {
        const id = card.id.replace('user-', '');
        const name = document.getElementById(`name-${id}`)?.value.trim() || `ç”¨æˆ·${id}`;
        const bets = document.getElementById(`bets-${id}`)?.value.trim();
        if (bets) {
            userData.push({ name, bets });
        }
    });

    if (userData.length === 0) return alert('è¯·è‡³å°‘è¾“å…¥ä¸€ä¸ªç”¨æˆ·çš„æŠ•æ³¨å†…å®¹ï¼');

    document.getElementById('results-container').style.display = 'block';
    document.getElementById('win-display-all').textContent = 'å¼€å¥–å·ç ï¼š' + getWinningDisplay(winningNumbers);
    document.getElementById('time-display').textContent = 'ç”Ÿæˆæ—¶é—´ï¼š' + new Date().toLocaleString();

    const resultContainer = document.getElementById('results-inner');
    resultContainer.innerHTML = '';
    
    // å­˜å‚¨æ¯ä¸ªç”¨æˆ·çš„ç»Ÿè®¡æ•°æ®
    const userStats = [];
    let totalAllCost = 0, totalAllWin = 0, totalWinBetAmount = 0;

    userData.forEach(user => {
        const rawLines = user.bets.split('\n').filter(l => l.trim());
        const lines = [];
        rawLines.forEach(raw => {
            lines.push(...splitBetsByAmount(raw));
        });

        const processedLines = processNewOldBets(lines);

        let allBets = [];
        let userCost = 0, userWin = 0, userWinBetAmount = 0;

        processedLines.forEach(item => {
            const trimmedLine = item.line;
            if (!trimmedLine) return;

            const betType = item.betType !== null ? item.betType : getBetType(trimmedLine);
            const perBet = extractAmount(trimmedLine);
            const numbers = parseNumbers(trimmedLine);
            if (numbers.length === 0) return;

            const cost = numbers.length * perBet;
            const winAmount = getWinAmount(betType, perBet, numbers, winningNumbers);
            const isWin = winAmount > 0;

            userCost += cost;
            userWin += winAmount;
            
            if (isWin) {
                userWinBetAmount += perBet;
            }

            const betItem = { 
                line: trimmedLine, 
                numCount: numbers.length, 
                perBet, 
                cost, 
                winAmount, 
                isWin, 
                multiple: 47,
                numbers: numbers,
                betType: betType,
                originalLine: item.originalLine,
                isSplit: item.isSplit,
                splitType: item.splitType
            };

            allBets.push(betItem);
        });

        totalAllCost += userCost;
        totalAllWin += userWin;
        totalWinBetAmount += userWinBetAmount;
        const profit = userWin - userCost;

        // ä¿å­˜ç”¨æˆ·ç»Ÿè®¡æ•°æ®
        userStats.push({
            name: user.name,
            cost: userCost,
            win: userWin,
            profit: profit,
            winBetAmount: userWinBetAmount
        });

        let html = `<div class="result-card"><h3>ğŸ‘¤ ${user.name}</h3>`;

        if (allBets.length === 0) {
            html += `<p style="color:#999;">ğŸš« æ— æœ‰æ•ˆæŠ•æ³¨å†…å®¹</p>`;
        } else {
            html += `<div class="section-title">æŠ•æ³¨è¯¦æƒ…ï¼ˆ47å€ï¼‰</div>
            <table><tr><th>å†…å®¹</th><th>å·ç æ•°é‡</th><th>æŠ•å…¥</th><th>ä¸­å¥–</th></tr>`;
            
            allBets.forEach(i => {
                let lineDisplay = i.line;
                if (i.isSplit) {
                    lineDisplay = `<span title="åŸæŠ•æ³¨: ${i.originalLine}">${i.line}</span>`;
                }
                
                html += `<tr>
                    <td>${lineDisplay} ${getBetTypeLabel(i.betType)}</td>
                    <td>${i.numCount}</td>
                    <td><span class="money-blue">${i.cost} å…ƒ</span></td>
                    <td class="${i.isWin?'win':''}"><span class="money-red">${i.isWin?i.winAmount+' å…ƒ':'-'}</span></td>
                </tr>`;
                
                if (i.isSplit) {
                    html += `<tr><td colspan="4" class="split-info">ğŸ“ è‡ªåŠ¨æ‹†åˆ†è‡ª: "${i.originalLine}" â†’ ${i.splitType}</td></tr>`;
                }
                
                let matchInfo = `è§£æå·ç : ${i.numbers.join(', ')} | å•æ³¨é‡‘é¢: ${i.perBet}ç±³ | ç±»å‹: ${i.betType}`;
                if (i.betType === 'normal') {
                    matchInfo += ` | åŒ¹é…: æ–°æ¾³${winningNumbers.macau}`;
                } else if (i.betType === 'macau' && winningNumbers.macau) {
                    matchInfo += ` | åŒ¹é…: æ–°æ¾³${winningNumbers.macau}`;
                } else if (i.betType === 'old-macau' && winningNumbers.oldMacau) {
                    matchInfo += ` | åŒ¹é…: æ—§æ¾³${winningNumbers.oldMacau}`;
                } else if (i.betType === 'hongkong' && winningNumbers.hongkong) {
                    matchInfo += ` | åŒ¹é…: é¦™æ¸¯${winningNumbers.hongkong}`;
                }
                html += `<tr><td colspan="4" class="debug-info">${matchInfo}</td></tr>`;
            });
            
            html += `</table>`;
            
            html += `<div class="total">
                ğŸ’° æŠ•å…¥ï¼š<span class="money-blue">${userCost} å…ƒ</span> | ä¸­å¥–ï¼š<span class="money-red">${userWin} å…ƒ</span> | å‡€åˆ©æ¶¦ï¼š<span class="${profit>=0?'profit-positive':'profit-negative'}">${profit>=0?'+':''}${profit}</span> <span class="${profit>=0?'money-red':'money-blue'}">å…ƒ</span><br>
                <span class="total-bet-win">ç´¯è®¡ä¸­å¥–æŠ•æ³¨ï¼š<span class="money-red">${userWinBetAmount} å…ƒ</span></span><br>
                <span class="zodiac-display"> ä»Šæ—¥ç”Ÿè‚–ï¼š${getTodayZodiacDisplay(winningNumbers)}</span>
            </div>`;
        }

        html += `</div>`;
        resultContainer.innerHTML += html;
    });

    const totalProfit = totalAllWin - totalAllCost;
    
    // å…¨ä½“æ±‡æ€»
    resultContainer.innerHTML += `<div class="total" style="margin-top:20px;">
        ğŸ“Š å…¨ä½“æ±‡æ€»ï¼š<br>
        æ€»æŠ•å…¥ï¼š<span class="money-blue">${totalAllCost} å…ƒ</span><br>
        æ€»ä¸­å¥–ï¼š<span class="money-red">${totalAllWin} å…ƒ</span><br>
        æ€»å‡€åˆ©æ¶¦ï¼š<span class="${totalProfit>=0?'profit-positive':'profit-negative'}">${totalProfit>=0?'+':''}${totalProfit}</span> <span class="${totalProfit>=0?'money-red':'money-blue'}">å…ƒ</span><br>
        <span class="total-bet-win">ç´¯è®¡ä¸­å¥–æŠ•æ³¨ï¼š<span class="money-red">${totalWinBetAmount} å…ƒ</span></span><br>
        <span class="zodiac-display"> ä»Šæ—¥ç”Ÿè‚–ï¼š${getTodayZodiacDisplay(winningNumbers)}</span>
    </div>`;
    
    // æ·»åŠ ç”¨æˆ·è¯¦ç»†ç»Ÿè®¡è¡¨æ ¼
    if (userStats.length > 0) {
        let userStatsHtml = `<div class="user-stats-table">
            <h3>ğŸ‘¥ ç”¨æˆ·è¯¦ç»†ç»Ÿè®¡</h3>
            <table>
                <tr>
                    <th>ç”¨æˆ·å</th>
                    <th>æŠ•å…¥</th>
                    <th>ä¸­å¥–</th>
                    <th>å‡€åˆ©æ¶¦</th>
                    <th>ç´¯è®¡ä¸­å¥–æŠ•æ³¨</th>
                </tr>`;
        
        userStats.forEach(stat => {
            userStatsHtml += `<tr>
                <td><strong>${stat.name}</strong></td>
                <td><span class="money-blue">${stat.cost} å…ƒ</span></td>
                <td><span class="money-red">${stat.win} å…ƒ</span></td>
                <td class="${stat.profit>=0?'profit-positive':'profit-negative'}">${stat.profit>=0?'+':''}${stat.profit} <span class="${stat.profit>=0?'money-red':'money-blue'}">å…ƒ</span></td>
                <td><span class="money-red">${stat.winBetAmount} å…ƒ</span></td>
            </tr>`;
        });
        
        userStatsHtml += `</table></div>`;
        resultContainer.innerHTML += userStatsHtml;
    }

    currentResults = {
        winningNumbers,
        userData,
        totals: {
            totalCost: totalAllCost,
            totalWin: totalAllWin,
            totalProfit: totalProfit,
            totalBetWin: totalWinBetAmount
        },
        userStats: userStats
    };
}

function hideResults() {
    document.getElementById('results-container').style.display = 'none';
}

// æµ‹è¯•æ‹†åˆ†åŠŸèƒ½
function testSplit() {
    const container = document.getElementById('users-container');
    const userCards = container.querySelectorAll('.user-card');
    
    let testContent = '';
    userCards.forEach(card => {
        const id = card.id.replace('user-', '');
        const bets = document.getElementById(`bets-${id}`)?.value.trim();
        if (bets) {
            testContent += `ç”¨æˆ·${id}:\n${bets}\n\n`;
        }
    });
    
    if (!testContent) {
        alert('è¯·å…ˆè¾“å…¥æŠ•æ³¨å†…å®¹ï¼');
        return;
    }
    
    const lines = splitBetsByAmount(testContent);
    const processedLines = processNewOldBets(lines);
    
    let result = `æ‹†åˆ†ç»“æœ (å…±${processedLines.length}æ¡):\n\n`;
    processedLines.forEach((item, index) => {
        result += `${index+1}. ${item.line}\n`;
        if (item.isSplit) {
            result += `   ğŸ“ è‡ªåŠ¨æ‹†åˆ†è‡ª: "${item.originalLine}" â†’ ${item.splitType}\n`;
        }
        const amount = extractAmount(item.line);
        const numbers = parseNumbers(item.line);
        const betType = item.betType !== null ? item.betType : getBetType(item.line);
        result += `   é‡‘é¢: ${amount}ç±³, å·ç : ${numbers.join(', ')}, ç±»å‹: ${betType}\n\n`;
    });
    
    alert(result);
}

// åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
    initHistory();
});
</script>

</body>
</html>
